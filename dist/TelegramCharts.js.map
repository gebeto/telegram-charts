{"version":3,"file":"TelegramCharts.js","sources":["../src/Utils/AnimationLoop.js","../src/Globals.js","../src/Utils/Mouse.js","../src/Utils/Animated.js","../src/utils.js","../src/Utils/YAxis.js","../src/UI/utils.js","../src/UI/Popup.js","../src/UI/Header.js","../src/UI/Buttons.js","../src/Drawers/Layers/Bar.js","../src/Drawers/Layers/utils.js","../src/Drawers/Layers/BarActivePopup.js","../src/Drawers/Layers/YAxis.js","../src/Drawers/Layers/XAxis.js","../src/Drawers/Charts/BarChart.js","../src/Drawers/Controls/utils.js","../src/Drawers/Controls/BarControls.js","../src/Drawers/Layers/Line.js","../src/Drawers/Layers/LineActivePopup.js","../src/Drawers/Charts/utils.js","../src/Drawers/Charts/DualLineChart.js","../src/Drawers/Charts/LineChart.js","../src/Drawers/Controls/LineControls.js","../src/Drawers/Layers/Area.js","../src/Drawers/Charts/AreaChart.js","../src/Drawers/Layers/AreaLine.js","../src/Drawers/Layers/AreaLineActivePopup.js","../src/Drawers/Charts/AreaLineChart.js","../src/Drawers/Controls/AreaLineControls.js","../src/ChartTypes.js","../src/Chart.js","../src/UI/Theme.js","../src/index.js"],"sourcesContent":["function createAnimationLoop() {\n  const animationHandlers = [];\n\n  const publicInterface = {\n    time: 0,\n    add(handler) {\n      animationHandlers.push(handler);\n    },\n    remove(handler) {\n      const index = animationHandlers.indexOf(handler);\n      if (index > -1) {\n        animationHandlers.splice(index, 1);\n      }\n    },\n  };\n\n  function loop(loopTime) {\n    publicInterface.time = loopTime;\n    for (let i = 0; i < animationHandlers.length; i++) {\n      animationHandlers[i](loopTime);\n    }\n    requestAnimationFrame(loop);\n  }\n  requestAnimationFrame(loop);\n\n  return publicInterface;\n}\n\nconst animationLoop = createAnimationLoop();\n\nexport default animationLoop;\n","export const MONTH_NAMES = [\n  \"Jan\",\n  \"Feb\",\n  \"Mar\",\n  \"Apr\",\n  \"May\",\n  \"Jun\",\n  \"Jul\",\n  \"Aug\",\n  \"Sep\",\n  \"Oct\",\n  \"Nov\",\n  \"Dec\",\n];\nexport const DAY_NAMES = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\n\nexport const PIXEL_RATIO = window.devicePixelRatio;\nexport const CONTROL_HEIGHT = 43 * PIXEL_RATIO;\n\nexport const DOT_RADIUS = 4 * PIXEL_RATIO;\nexport const DOT_RADIUS_DIV_2 = DOT_RADIUS / 2;\nexport const DOT_RADIUS_MUL_2 = DOT_RADIUS * 2;\nexport const CANVAS_HEIGHT = 343 * PIXEL_RATIO;\nexport const SIDES_PADDING = 16 * PIXEL_RATIO;\nexport const SIDES_PADDING2 = SIDES_PADDING * 2;\nexport const CHART_HEIGHT = CANVAS_HEIGHT - CONTROL_HEIGHT;\nexport const PI2 = Math.PI * 2;\nexport const PI1 = Math.PI / 100;\n\nexport const FONT = `${11 * PIXEL_RATIO}px sans-serif`;\nexport const AXIS_TEXT_WIDTH = 40 * PIXEL_RATIO;\nexport const AXIS_TEXT_WIDTH_DIV_2 = AXIS_TEXT_WIDTH / 2;\nexport const AXIS_TEXT_WIDTH_MUL_2 = AXIS_TEXT_WIDTH * 2;\nexport const AXIS_TEXT_WIDTH_MUL_3 = AXIS_TEXT_WIDTH * 3;\n\nexport const BOTTOM_PADDING = 7 * PIXEL_RATIO;\n\nexport const X_AXIS_HEIGHT = 29 * PIXEL_RATIO;\nexport const X_AXIS_HEIGHT_DIV_2 = X_AXIS_HEIGHT / 2;\n\nexport const Y_AXIS_TEXT_PADDING = 5 * PIXEL_RATIO;\nexport const ONE = 1 * PIXEL_RATIO;\nexport const TWO = 2 * PIXEL_RATIO;\n\nexport const ANIMATION_SPEED = 200;\n\nexport const CURRENT = {\n  THEME: {},\n};\n","import { PIXEL_RATIO } from '../Globals';\n\n// let lastEntered = null;\n\nfunction createDispatcher(types) {\n\tconst handlers = {};\n\tconst dispatchers = {};\n\tconst mouse = {\n\t\tx: 0,\n\t\ty: 0,\n\t\txRaw: 0,\n\t\tyRaw: 0,\n\n\t\tnewX: 0,\n\t\tnewY: 0,\n\t\tnewXRaw: 0,\n\t\tnewYRaw: 0,\n\n\t\tisHolding: false,\n\t}\n\ttypes.forEach(type => {\n\t\thandlers[type] = [];\n\t\tdispatchers[type] = function(mouse, event) {\n\t\t\tfor (let i = 0; i < handlers[type].length; i++) {\n\t\t\t\thandlers[type][i](mouse, event);\n\t\t\t}\n\t\t}\n\t});\n\treturn {\n\t\tmouse: mouse,\n\t\taddListener(type, handler) {\n\t\t\thandlers[type].push(handler);\n\t\t},\n\t\tremoveListener(type, handler) {\n\t\t\tconst index = handlers[type].indexOf(handler);\n\t\t\thandlers[type].splice(index, 1);\n\t\t},\n\t\tdispatch(type, event) {\n\t\t\tif (dispatchers[type]) {\n\t\t\t\tdispatchers[type](mouse, event);\n\t\t\t} else {\n\t\t\t\tthrow Error(\"Unknown event\");\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport function createMouseForChart(config) {\n\tconst dispatcher = createDispatcher(['move', 'enter', 'leave', 'down', 'up']);\n\tconst mouse = dispatcher.mouse;\n\n\tfunction onMouseDown(e) {\n\t\tmouse.xRaw = e.clientX - config.canvasBounds.left;\n\t\tmouse.yRaw = e.clientY - config.canvasBounds.top;\n\t\tmouse.x = mouse.xRaw * PIXEL_RATIO;\n\t\tmouse.y = mouse.yRaw * PIXEL_RATIO;\n\n\t\tmouse.newXRaw = mouse.xRaw;\n\t\tmouse.newYRaw = mouse.yRaw;\n\t\tmouse.newX = mouse.x;\n\t\tmouse.newY = mouse.y;\n\n\t\tdispatcher.dispatch('down', e);\n\t}\n\n\tfunction onMouseMove(e) {\n\t\tmouse.newXRaw = e.clientX - config.canvasBounds.left;\n\t\tmouse.newYRaw = e.clientY - config.canvasBounds.top;\n\t\tmouse.newX = mouse.newXRaw * PIXEL_RATIO;\n\t\tmouse.newY = mouse.newYRaw * PIXEL_RATIO;\n\n\t\tdispatcher.dispatch('move', e);\n\t}\n\n\tfunction onMouseEnter(e) {\n\t\tdispatcher.dispatch('enter', e);\n\t}\n\n\tfunction onMouseUp(e) {\n\t\tmouse.isHolding = false;\n\t\tdispatcher.dispatch('up', e);\n\t}\n\n\tfunction onTouchDown(e) {\n\t\tonMouseDown(e.touches[0]);\n\t}\n\tfunction onTouchMove(e) {\n\t\tonMouseMove(e.touches[0]);\n\t}\n\n\tdocument.addEventListener('mousedown', onMouseDown);\n\tdocument.addEventListener('mousemove', onMouseMove);\n\tdocument.addEventListener('mouseup', onMouseUp);\n\n\tdocument.addEventListener('touchstart', onTouchDown);\n\tdocument.addEventListener('touchmove', onTouchMove, { passive: false });\n\tdocument.addEventListener('touchend', onMouseUp);\n\tdocument.addEventListener('touchcancel', onMouseUp);\n\tdocument.addEventListener('selectstart', e => false);\n\n\treturn {\n\t\tmouse: mouse,\n\t\taddListener: dispatcher.addListener,\n\t\tremoveListener: dispatcher.removeListener,\n\t};\n}","import AnimationLoop from './AnimationLoop';\n\n\nexport default class Animated {\n\tconstructor(value, duration, onAnimation) {\n\t\tthis.onAnimation = onAnimation;\n\t\tthis.fromValue = value;\n\t\tthis.toValue = value;\n\t\tthis.value = value;\n\t\tthis.startTime = 0;\n\t\tthis.duration = duration;\n\t\tthis.delay = 0;\n\n\t\tthis.inProgress = false;\n\t}\n\n\tplayFrom(fromValue, toValue) {\n\t\tthis.value = fromValue;\n\t\tthis.play(toValue);\n\t}\n\n\tplay(toValue) {\n\t\tthis.inProgress = true;\n\t\tthis.startTime = AnimationLoop.time;\n\t\tthis.toValue = toValue;\n\t\tthis.fromValue = this.value;\n\t}\n\n\tupdate() {\n\t\tconst result = this._update();\n\t\tresult && this.onAnimation && this.onAnimation(this.value);\n\t\treturn result;\n\t}\n\n\t_update() {\n\t\tif (this.value === this.toValue) {\n\t\t\tthis.inProgress = false;\n\t\t\treturn false;\n\t\t}\n\t\tthis.inProgress = true;\n\t\tlet progress = ((AnimationLoop.time - this.startTime) - this.delay) / this.duration;\n\t\tif (progress < 0) progress = 0;\n\t\tif (progress > 1) progress = 1;\n\t\tconst ease = -progress * (progress - 2);\n\t\tthis.value = this.fromValue + (this.toValue - this.fromValue) * ease;\n\t\treturn true;\n\t}\n}\n\n\nexport function animateObject(animator, object, key, valueFrom, valueTo, onFrame) {\n\tconst MULTIPLIER = 100;\n\tconst animation = animator.createAnimation(Math.round(valueFrom * MULTIPLIER), 200, (value) => {\n\t\tobject[key] = value / MULTIPLIER;\n\t\tonFrame && onFrame(object[key]);\n\t});\n\tanimation.play(Math.round(valueTo * MULTIPLIER));\n}\n\n\nexport function createAnimator() {\n\tconst animations = [];\n\tconst opts = {\n\t\tactive: false,\n\t};\n\n\tfunction createAnimation(value, duration, onAnimation) {\n\t\tconst animation = new Animated(value, duration, onAnimation)\n\t\tanimations.push(animation);\n\t\treturn animation;\n\t}\n\n\tfunction removeAnimation(animation) {\n\t\tconst index = animations.indexOf(animation);\n\t\tif (index > -1) {\n\t\t\tanimations.splice(index, 1);\n\t\t}\n\t}\n\n\tfunction updateAnimations() {\n\t\tconst count = animations.length;\n\t\tlet isActive = false;\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tisActive = animations[i].update() || isActive;\n\t\t}\n\t\topts.active = isActive;\n\t\treturn isActive;\n\t}\n\n\treturn {\n\t\topts,\n\t\tcreateAnimation,\n\t\tremoveAnimation,\n\t\tupdateAnimations,\n\t}\n}","import { ANIMATION_SPEED } from './Globals';\nimport Animated from './Utils/Animated';\n\n\nexport function formatNumber(n, short) {\n\tvar abs = Math.abs(n);\n\tif (abs > 1000000000 && short) return (n / 1000000000).toFixed(2) + 'B';\n\tif (abs > 1000000 && short) return (n / 1000000).toFixed(2) + 'M';\n\tif (abs > 1000 && short) return (n / 1000).toFixed(1) + 'K';\n\tif (abs > 1) return n.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \" \");\n\treturn n.toString()\n}\n\n\nexport function normalizeMemo(min, max) {\n\tconst delta = max - min;\n\tconst memo = {};\n\n\tfunction norm(val) {\n\t\tif (!memo[val]) {\n\t\t\tmemo[val] = (val - min) / delta;\n\t\t}\n\t\treturn memo[val];\n\t}\n\n\tnorm.de = function denorm(val) {\n\t\treturn val * delta + min;\n\t}\n\n\tnorm.data = {\n\t\tdelta: delta,\n\t\tmin: min,\n\t\tmax: max,\n\t}\n\n\treturn norm;\n}\n\nexport function normalize(min, max) {\n\tconst delta = max - min;\n\n\tfunction norm(val) {\n\t\treturn (val - min) / delta;\n\t};\n\n\tnorm.de = function denorm(val) {\n\t\treturn val * delta + min;\n\t}\n\n\treturn norm;\n}\n\nexport function normalizeAnimated(animator, min, max) {\n\tlet newMax = min;\n\tconst newMin = animator.createAnimation(min, ANIMATION_SPEED);\n\tconst delta = animator.createAnimation(max - min, ANIMATION_SPEED);\n\tfunction norm(val) {\n\t\treturn (val - newMin.value) / delta.value;\n\t};\n\tnorm.updateDelta = (min, max) => {\n\t\tnewMax = max;\n\t\tnewMin.play(min);\n\t\tdelta.play(max - min);\n\t};\n\treturn norm;\n}\n\nexport const debounce = (func, delay) => {\n\tlet inDebounce\n\treturn function() {\n\t\tconst context = this\n\t\tconst args = arguments\n\t\tclearTimeout(inDebounce)\n\t\tinDebounce = setTimeout(() => func.apply(context, args), delay)\n\t}\n}\n\nexport const throttle = (func, limit) => {\n\tlet inThrottle;\n\treturn function() {\n\t\tconst args = arguments;\n\t\tconst context = this;\n\t\tif (!inThrottle) {\n\t\t\tfunc.apply(context, args);\n\t\t\tinThrottle = true;\n\t\t\tsetTimeout(() => inThrottle = false, limit);\n\t\t}\n\t}\n}\n\nexport const throttleL = (func, limit) => {\n\tlet inThrottle;\n\treturn function() {\n\t\tconst args = arguments;\n\t\tconst context = this;\n\t\tif (!inThrottle) {\n\t\t\tinThrottle = true;\n\t\t\tsetTimeout(() => {\n\t\t\t\tfunc.apply(context, args);\n\t\t\t\tinThrottle = false;\n\t\t\t}, limit);\n\t\t}\n\t}\n}\n\nexport const throttleLForceable = (func, limit) => {\n\tlet inThrottle;\n\treturn function(force) {\n\t\tconst context = this;\n\t\tif (force) {\n\t\t\tfunc.apply(context, null);\n\t\t\treturn;\n\t\t}\n\t\tif (!inThrottle) {\n\t\t\tinThrottle = true;\n\t\t\tsetTimeout(() => {\n\t\t\t\tfunc.apply(context, null);\n\t\t\t\tinThrottle = false;\n\t\t\t}, limit);\n\t\t}\n\t}\n}\n\nexport function memo(fun) {\n\tconst memos = {};\n\treturn function memoized(arg) {\n\t\tif (!memos[arg]) {\n\t\t\tmemos[arg] = fun(arg);\n\t\t}\n\t\treturn memos[arg];\n\t}\n}\n\nexport const average = (curr, item) => curr + item;\n\n\n\n\nexport const uninf = (val) => (val === Infinity || val === -Infinity) ? 0 : val;\n\nexport const singleMin = set => Math.min.apply(null, set);\nexport const singleMax = set => Math.max.apply(null, set);\nexport const singleMinRange = (set, start, end) => Math.min.apply(null, set.slice(start, 1 + end));\nexport const singleMaxRange = (set, start, end) => Math.max.apply(null, set.slice(start, 1 + end));\n\nexport const flatMin = (arr) => Math.min.apply(null, arr.map(singleMin));\nexport const flatMax = (arr) => Math.max.apply(null, arr.map(singleMax));\nexport const flatMinRange = (arr, start, end) => Math.min.apply(null, arr.map(set => singleMinRange(set, start, end)));\nexport const flatMaxRange = (arr, start, end) => Math.max.apply(null, arr.map(set => singleMaxRange(set, start, end)));\n\n\nexport const zipSum = (arr) => {\n\t// console.log(arr.length);\n\tconst res = new Array(arr[0].length).fill(0);\n\tlet i, j\n\tfor (i = 0; i < arr.length; i++) {\n\t\tfor (j = 0; j < arr[i].length; j++) {\n\t\t\tres[j] += arr[i][j];\n\t\t}\n\t}\n\treturn res;\n}\n\nexport const flatMaxZipSum = (arr, start, end) => {\n\treturn arr.map(set => singleMax(set));\n};\n\nexport const flatMaxZipSumRange = (arr, start, end) => {\n\treturn arr.map(set => singleMaxRange(set, start, end)).reduce((sum, el) => sum + el, 0);\n};","import {\n\tANIMATION_SPEED,\n\tMONTH_NAMES,\n\tDAY_NAMES,\n} from '../Globals';\n\nimport {\n\tnormalizeAnimated,\n\tnormalize,\n\tzipSum,\n\n\tuninf,\n\tsingleMin,\n\tsingleMax,\n\tsingleMinRange,\n\tsingleMaxRange,\n\tflatMin,\n\tflatMax,\n\tflatMinRange,\n\tflatMaxRange,\n} from '../utils';\n\n\n\nexport const DATE_TYPE_HOUR = 3600000\nexport const DATE_TYPE_DAY = 86400000\nexport const DATE_TYPE_WEEK = 3\nexport const DATE_TYPES = {\n\t[DATE_TYPE_HOUR]: {\n\t\tdayString: (date) => date.toISOString().split(\"T\")[1].split(\":\").slice(0, 2).join(':'),\n\t\tdateString: (date) => `${DAY_NAMES[date.getDay()]}, ${date.toISOString().split(\"T\")[1].split(\":\").slice(0, 2).join(':')}`,\n\t\tdateStringTitle: (date) => `${date.getDate()} ${MONTH_NAMES[date.getMonth()]} ${date.getFullYear()}`,\n\t},\n\t[DATE_TYPE_DAY]: {\n\t\tdayString: (date) => `${MONTH_NAMES[date.getMonth()]} ${date.getDate()}`,\n\t\tdateString: (date) => `${DAY_NAMES[date.getDay()]}, ${date.getDate()} ${MONTH_NAMES[date.getMonth()]} ${date.getFullYear()}`,\n\t\tdateStringTitle: (date) => `${date.getDate()} ${MONTH_NAMES[date.getMonth()]} ${date.getFullYear()}`,\n\t},\n\t[DATE_TYPE_WEEK]: {\n\t\tdayString: (date) => `${MONTH_NAMES[date.getMonth()]} ${date.getDate()}`,\n\t\tdateString: (date) => `${DAY_NAMES[date.getDay()]}, ${date.getDate()} ${MONTH_NAMES[date.getMonth()]} ${date.getFullYear()}`,\n\t\tdateStringTitle: (date) => `${date.getDate()} ${MONTH_NAMES[date.getMonth()]} ${date.getFullYear()}`,\n\t},\n};\n\nexport function dateString(timestamp, dateType, timezoneOffset) {\n\tconst date = new Date(timestamp);\n\tconst result = {\n\t\tdayString: `${MONTH_NAMES[date.getMonth()]} ${date.getDate()}`,\n\t\tdateString: `${DAY_NAMES[date.getDay()]}, ${date.getDate()} ${MONTH_NAMES[date.getMonth()]} ${date.getFullYear()}`,\n\t\tdateStringTitle: `${date.getDate()} ${MONTH_NAMES[date.getMonth()]} ${date.getFullYear()}`,\n\t\tdate: date,\n\t\ttimestamp: timestamp,\n\t};\n\tif (dateType) {\n\t\tresult.dayString = dateType.dayString(date);\n\t\tresult.dateString = dateType.dateString(date);\n\t\tresult.dateStringTitle = dateType.dateStringTitle(date);\n\t}\n\treturn result;\n}\n\nexport function createPercentDefaultHandler(data) {\n\treturn function percentageDefaultHandler(timestamp) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tresolve(data);\n\t\t});\n\t}\n}\n\nexport function prepareDataset(data, config) {\n\tconst { title, columns, types, colors, names } = data; // main data\n\tconst { percentage, stacked, y_scaled, x_on_zoom } = data; // options\n\n\tconst [[xAxisKey, ...rawXAxis], ...rawYAxisList] = columns;\n\tconst xDiff = rawXAxis[1] - rawXAxis[0];\n\tconst xAxis = rawXAxis.map(el => dateString(el, DATE_TYPES[xDiff]));\n\tconst yAxis = prepareYAxis(rawYAxisList, data, config);\n\n\treturn {\n\t\ttitle, columns, types, colors, names,\n\n\t\tx_on_zoom: (percentage && !x_on_zoom) ? createPercentDefaultHandler(data) : x_on_zoom,\n\t\tpercentage, stacked, y_scaled,\n\n\t\txAxis, yAxis,\n\t};\n}\n\n\nexport function prepareYAxis(rawYs, data, config) {\n\tconst items = rawYs.map(y => {\n\t\tconst [yKey, ...yData] = y;\n\t\tconst item = {\n\t\t\topacity: config.animator.createAnimation(1, ANIMATION_SPEED),\n\t\t\tkey: yKey,\n\t\t\tscaling: {},\n\t\t\tenabled: true,\n\t\t\titems: yData,\n\t\t};\n\n\t\tif (data.y_scaled) {\n\t\t\titem.scaling.color = data.colors[item.key];\n\t\t\titem.scaling.minHeight = uninf(singleMin(item.items));\n\t\t\titem.scaling.maxHeight = uninf(singleMax(item.items));\n\t\t\titem.scaling.minHeightAnim = config.animator.createAnimation(0, ANIMATION_SPEED);\n\t\t\titem.scaling.maxHeightAnim = config.animator.createAnimation(0, ANIMATION_SPEED);\n\t\t\titem.scaling.normY = normalizeAnimated(config.animator, item.scaling.minHeight, item.scaling.maxHeight);\n\t\t\titem.scaling.normControlY = normalizeAnimated(config.animator, item.scaling.minHeight, item.scaling.maxHeight);\n\n\t\t\titem.scaling.updateMinMax = function updateMinMax(startIndex, endIndex) {\n\t\t\t\titem.scaling.minHeight = uninf(singleMinRange(item.items, startIndex, endIndex));\n\t\t\t\titem.scaling.maxHeight = uninf(singleMaxRange(item.items, startIndex, endIndex));\n\t\t\t\titem.scaling.minHeightAnim.play(item.scaling.minHeight);\n\t\t\t\titem.scaling.maxHeightAnim.play(item.scaling.maxHeight);\n\t\t\t\titem.scaling.normY.updateDelta(item.scaling.minHeight, item.scaling.maxHeight);\n\t\t\t}\n\t\t}\n\n\t\treturn item;\n\t});\n\n\tif (!data.y_scaled) {\n\t\tconst sharedScaling = {};\n\n\t\tif (data.percentage) {\n\t\t\tscaling_Percentage(config, sharedScaling, items);\n\t\t} else if (data.stacked) {\n\t\t\tscaling_Stacked(config, sharedScaling, items);\n\t\t} else {\n\t\t\tscaling_Default(config, sharedScaling, items);\n\t\t}\n\n\t\titems.forEach(item => { item.scaling = sharedScaling; })\n\t}\n\n\n\treturn {\n\t\titems: items,\n\t}\n}\n\n\n\nfunction scaling_Percentage(config, sharedScaling, items) {\n\t// PERCENTAGE\n\tconst minHeight = 0;\n\tconst maxHeight = 100;\n\tconst minHeightAnim = config.animator.createAnimation(minHeight, ANIMATION_SPEED);\n\tconst maxHeightAnim = config.animator.createAnimation(maxHeight, ANIMATION_SPEED);\n\n\tsharedScaling.minHeight = minHeight;\n\tsharedScaling.maxHeight = maxHeight;\n\tsharedScaling.minHeightAnim = minHeightAnim;\n\tsharedScaling.maxHeightAnim = maxHeightAnim;\n\tsharedScaling.normY = normalizeAnimated(config.animator, minHeight, maxHeight);\n\tsharedScaling.normControlY = normalizeAnimated(config.animator, minHeight, maxHeight);\n\n\tsharedScaling.updateMinMax = function updateMinMax(startIndex, endIndex) {};\n}\n\n\nfunction scaling_Stacked(config, sharedScaling, items) {\n\t// STACKED\n\tconst rawItems = items.map(f => f.items);\n\tconst min = 0;\n\tconst max = uninf(singleMax(zipSum(rawItems)));\n\tconst minHeight = 0;\n\tconst maxHeight = singleMaxRange(zipSum(rawItems), min, max);\n\tconst minHeightAnim = config.animator.createAnimation(0, ANIMATION_SPEED);\n\tconst maxHeightAnim = config.animator.createAnimation(0, ANIMATION_SPEED);\n\n\tsharedScaling.minHeight = minHeight;\n\tsharedScaling.maxHeight = maxHeight;\n\tsharedScaling.minHeightAnim = minHeightAnim;\n\tsharedScaling.maxHeightAnim = maxHeightAnim;\n\tsharedScaling.normY = normalizeAnimated(config.animator, minHeight, maxHeight);\n\tsharedScaling.normControlY = normalizeAnimated(config.animator, 0, max);\n\n\tfunction updateMinMax(startIndex, endIndex) {\n\t\t// console.log('UPD MIN')\n\t\tconst filteredRawItems = items.filter(y => y.enabled).map(y => y.items);\n\t\tsharedScaling.minHeight = 0;\n\t\ttry {\n\t\t\tsharedScaling.maxHeight = uninf(singleMaxRange(zipSum(filteredRawItems), startIndex, endIndex));\n\t\t} catch(err) {\n\t\t\treturn;\n\t\t}\n\t\tsharedScaling.minHeightAnim.play(sharedScaling.minHeight);\n\t\tsharedScaling.maxHeightAnim.play(sharedScaling.maxHeight);\n\t\tsharedScaling.normY.updateDelta(sharedScaling.minHeight, sharedScaling.maxHeight);\n\n\t\tconst min = 0;\n\t\tconst max = uninf(singleMax(zipSum(filteredRawItems)));\n\t\tsharedScaling.normControlY.updateDelta(min, max);\n\t}\n\n\tsharedScaling.updateMinMax = updateMinMax;\n}\n\n\nfunction scaling_Default(config, sharedScaling, items) {\n\tconst rawItems = items.map(f => f.items);\n\n\tconst min = uninf(flatMin(rawItems));\n\tconst max = uninf(flatMax(rawItems));\n\tconst minHeight = flatMin(rawItems, min, max);\n\tconst maxHeight = flatMax(rawItems, min, max);\n\tconst minHeightAnim = config.animator.createAnimation(0, ANIMATION_SPEED);\n\tconst maxHeightAnim = config.animator.createAnimation(0, ANIMATION_SPEED);\n\n\tsharedScaling.minHeight = minHeight;\n\tsharedScaling.maxHeight = maxHeight;\n\tsharedScaling.minHeightAnim = minHeightAnim;\n\tsharedScaling.maxHeightAnim = maxHeightAnim;\n\tsharedScaling.normY = normalizeAnimated(config.animator, minHeight, maxHeight);\n\tsharedScaling.normControlY = normalizeAnimated(config.animator, min, max);\n\n\tfunction updateMinMax(startIndex, endIndex) {\n\t\t// console.log('UPD MIN')\n\t\tconst filteredRawItems = items.filter(y => y.enabled).map(y => y.items);\n\t\tsharedScaling.minHeight = uninf(flatMinRange(filteredRawItems, startIndex, endIndex));\n\t\tsharedScaling.maxHeight = uninf(flatMaxRange(filteredRawItems, startIndex, endIndex));\n\t\tsharedScaling.minHeightAnim.play(sharedScaling.minHeight);\n\t\tsharedScaling.maxHeightAnim.play(sharedScaling.maxHeight);\n\t\tsharedScaling.normY.updateDelta(sharedScaling.minHeight, sharedScaling.maxHeight);\n\n\t\tconst min = uninf(flatMin(filteredRawItems));\n\t\tconst max = uninf(flatMax(filteredRawItems));\n\t\tsharedScaling.normControlY.updateDelta(min, max);\n\t}\n\n\tsharedScaling.updateMinMax = updateMinMax;\n}","export function createElement(parent, elementTag, className) {\n\tconst element = document.createElement(elementTag);\n\telement.className = className;\n\tif (parent) {\n\t\tparent.appendChild(element);\n\t}\n\treturn element;\n}\n\nexport function createLongPress(button, handlePress, handleLongPress) {\n\tlet timeout = null;\n\tlet dropClick = false;\n\n\tfunction mouseUp() {\n\t\tclearTimeout(timeout);\n\t\tif (dropClick) {\n\t\t\tdropClick = false;\n\t\t\treturn;\n\t\t}\n\n\t\thandlePress && handlePress();\n\t}\n\n\tfunction mouseDown() {\n\t\ttimeout = setTimeout(() => {\n\t\t\thandleLongPress && handleLongPress();\n\t\t\tdropClick = true;\n\t\t}, 200);\n\t}\n\n\tfunction mouseMove() {\n\t\tclearTimeout(timeout);\n\t}\n\n\tfunction init() {\n\t\tbutton.addEventListener('click', mouseUp);\n\t\tbutton.addEventListener('mousedown', mouseDown);\n\t\tbutton.addEventListener('mousemove', mouseMove);\n\t\tbutton.addEventListener('touchstart', mouseDown);\n\t\tbutton.addEventListener('touchmove', mouseMove);\n\t}\n\n\tfunction destroy() {\n\t\tbutton.removeEventListener('click', mouseUp);\n\t\tbutton.removeEventListener('mousedown', mouseDown);\n\t\tbutton.removeEventListener('mousemove', mouseMove);\n\t\tbutton.removeEventListener('touchstart', mouseDown);\n\t\tbutton.removeEventListener('touchmove', mouseMove);\n\t}\n\n\tinit();\n\n\treturn {\n\t\tinit, destroy,\n\t};\n}","import { createElement } from './utils';\nimport { formatNumber } from '../utils';\n\nexport function createPopupHeader(title, widthArrow) {\n\treturn `\n\t\t<strong class=\"chart__popup-header\">\n\t\t\t<span class=\"chart__popup-header-title\">${title}</span>\n\t\t\t${widthArrow ? '<span class=\"chart__popup-header-icon\"></span>' : '<span></span>'}\n\t\t</strong>\n\t`;\n}\n\n\nexport function createPopupItem(color, title, value) {\n\treturn `\n\t\t<span class=\"chart__popup-item\">\n\t\t\t<span class=\"chart__popup-item-title\">${title}</span>\n\t\t\t<span class=\"chart__popup-item-value\" style=\"color: ${color}\">${formatNumber(value)}</span>\n\t\t</span>\n\t`;\n}\n\n\nexport function createPopup(container, config) {\n\tconst popup = createElement(container, 'div', 'chart__popup');\n\tconst clickHandlers = [];\n\tlet currentIndex = -1;\n\n\tpopup.addEventListener('click', () => {\n\t\tif (config.data.xAxis[currentIndex]) {\n\t\t\tfor (let i = 0; i < clickHandlers.length; i++) {\n\t\t\t\tclickHandlers[i](config.data.xAxis[currentIndex].timestamp);\n\t\t\t}\n\t\t}\n\t});\n\n\tfunction changeHtml(index) {\n\t\tconst filtered = config.data.yAxis.items.filter(y => y.enabled)\n\t\tconst curr = filtered.map(y => createPopupItem(config.data.colors[y.key], config.data.names[y.key], y.items[index]));\n\t\tif (!curr.length) return;\n\t\tpopup.innerHTML = `\n\t\t\t${createPopupHeader(config.data.xAxis[index].dateString, config.data.x_on_zoom)}\n\t\t\t${curr.join('')}\n\t\t`;\n\t}\n\n\tconst publicInterface = {\n\t\telement: popup,\n\t\tupdate: changeHtml,\n\t\tshow(index) {\n\t\t\tcurrentIndex = index;\n\t\t\tchangeHtml(index);\n\t\t\tpopup.style.opacity = 1;\n\t\t\tpopup.style.visibility = 'visible';\n\t\t},\n\t\thide() {\n\t\t\tcurrentIndex = -1;\n\t\t\tpopup.style.opacity = 0;\n\t\t\tpopup.style.visibility = 'hidden';\n\t\t},\n\t\tonClick(handler) {\n\t\t\tclickHandlers.push(handler);\n\t\t}\n\t};\n\n\treturn publicInterface;\n}","import { createElement } from './utils';\n\n\nexport function createHeader(container, titleText, subtitleText) {\n\tconst header = createElement(container, 'div', 'chart__header');\n\n\tconst title = createElement(header, 'h2', 'chart__header-title');\n\ttitle.textContent = titleText;\n\n\tconst subtitle = createElement(header, 'h3', 'chart__header-sub-title');\n\tsubtitle.textContent = subtitleText;\n\n\tlet isSubtitleFreezed = false;\n\n\treturn {\n\t\tsetTitle(titleText) {\n\t\t\ttitle.textContent = titleText;\n\t\t},\n\t\tsetTitleButton(titleText, onClick) {\n\t\t\tfunction buttonClickHandler(e) {\n\t\t\t\tonClick && onClick(e);\n\t\t\t\tbutton.removeEventListener('click', buttonClickHandler);\n\t\t\t}\n\t\t\tconst button = createElement(null, 'span', 'chart__header-title-button')\n\t\t\tbutton.textContent = titleText;\n\t\t\tbutton.addEventListener('click', buttonClickHandler);\n\t\t\ttitle.innerHTML = '';\n\t\t\ttitle.appendChild(button);\n\t\t},\n\t\tsetSubtitle(subtitleText) {\n\t\t\tif (isSubtitleFreezed) return;\n\t\t\tsubtitle.textContent = subtitleText;\n\t\t},\n\t\tfreezeSubtitle(subtitleText) {\n\t\t\tisSubtitleFreezed = true;\n\t\t},\n\t\tunfreezeSubtitle() {\n\t\t\tisSubtitleFreezed = false;\n\t\t}\n\t}\n}","import { createElement, createLongPress } from './utils';\n\n\nexport function createButtonForAxis(container, config, y, globState, handler) {\n\tconst key = y.key;\n\tconst state = {\n\t\tkey: key,\n\t\tenabled: true,\n\t};\n\tconst button = createElement(container, 'button', 'chart__buttons-button');\n\tbutton.textContent = config.data.names[key];\n\tbutton.style.backgroundColor = config.data.colors[key];\n\tbutton.style.borderColor = config.data.colors[key];\n\tconst longPress = createLongPress(button, onPress, onLongPress);\n\n\tfunction destroy() {\n\t\tcontainer && container.removeChild(button);\n\t\tlongPress.destroy();\n\t}\n\n\tfunction init() {\n\t\tcontainer && container.appendChild(button);\n\t\tlongPress.init();\n\t}\n\n\tfunction onPress() {\n\t\tif (globState.activeButtonsCount === 1 && state.enabled) {\n\t\t\tbutton.className = 'chart__buttons-button error';\n\t\t\tsetTimeout(() => {button.className = 'chart__buttons-button';}, 140)\n\t\t\treturn;\n\t\t}\n\n\t\tstate.enabled = !state.enabled;\n\t\tupdate();\n\t}\n\n\tfunction onLongPress() {\n\t\tstate.show();\n\t\tglobState.hideAllExcept(button);\n\t}\n\t\n\tfunction update(force) {\n\t\tif (state.enabled === true) {\n\t\t\tbutton.className = 'chart__buttons-button';\n\t\t\tbutton.style.color = '#FFF';\n\t\t} else {\n\t\t\tbutton.className = 'chart__buttons-button unchecked';\n\t\t\tbutton.style.color = config.data.colors[key];\n\t\t}\n\n\t\tconst shouldCallUpdateHandler = y.enabled !== state.enabled;\n\t\ty.enabled = state.enabled;\n\t\tif (force) {\n\t\t\ty.opacity.value = state.enabled ? 0.99 : 0.01;\n\t\t}\n\t\ty.opacity.play(state.enabled ? 1 : 0);\n\n\t\tshouldCallUpdateHandler && handler && handler(state.enabled);\n\t}\n\n\tfunction hide(caller) {\n\t\tif (state.enabled && caller !== button) {\n\t\t\tstate.enabled = false;\n\t\t\tupdate();\n\t\t}\n\t}\n\n\tfunction show() {\n\t\tif (!state.enabled) {\n\t\t\tstate.enabled = true;\n\t\t\tupdate();\n\t\t}\n\t}\n\n\tstate.update = update;\n\tstate.hide = hide;\n\tstate.show = show;\n\n\tstate.destroy = destroy;\n\tstate.init = init;\n\n\treturn state;\n}\n\nexport function createButtons(container, config, handler) {\n\tconst globalState = {\n\t\tactiveButtonsCount: config.data.yAxis.items.length,\n\n\t\thideAllExcept: hideAllExcept,\n\t\thideAll: hideAll,\n\t};\n\n\n\tconst buttonsWrapper = createElement(container, 'div', 'chart__buttons');\n\tconst allButtons = {};\n\n\tconst buttons = config.data.yAxis.items.map(y => {\n\t\tconst button = createButtonForAxis(config.data.yAxis.items.length > 1 ? buttonsWrapper : null, config, y, globalState, (enabled) => {\n\t\t\tglobalState.activeButtonsCount += enabled ? 1 : -1;\n\t\t\tif (globalState.activeButtonsCount < 1) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\thandler && handler();\n\t\t});\n\t\treturn allButtons[y.key] = button;\n\t});\n\n\tfunction hideAll() {\n\t\tbuttons.forEach(button => {\n\t\t\tbutton.hide();\n\t\t});\n\t}\n\n\tfunction hideAllExcept(caller) {\n\t\tbuttons.forEach(button => {\n\t\t\tbutton.hide(caller);\n\t\t});\n\t}\n\n\tfunction destroy() {\n\t\tbuttons.map(button => button.destroy());\n\t\tcontainer.removeChild(buttonsWrapper);\n\t}\n\n\tfunction init() {\n\t\tbuttons.map(button => button.init());\n\t\tcontainer.appendChild(buttonsWrapper);\n\t}\n\n\tallButtons.mergeState = function mergeState(oldButtons) {\n\t\tbuttons.map(button => {\n\t\t\t// config.control.shouldUpdate = true;\n\t\t\t// config.chart.shouldUpdate = true;\n\t\t\t// button.update(true);\n\n\t\t\tconfig.control.shouldUpdate = true;\n\t\t\tconfig.chart.shouldUpdate = true;\n\t\t\tif (oldButtons[button.key]) {\n\t\t\t\tbutton.enabled = buttons.length > 1 ? oldButtons[button.key].enabled : true;\n\t\t\t}\n\t\t\tbutton.update(true);\n\t\t})\n\t}\n\n\tallButtons.destroy = destroy;\n\tallButtons.init = init;\n\n\treturn allButtons;\n}","import { PIXEL_RATIO } from '../../Globals';\n\n\nexport default function  Bar({ config, normYKey }, opts = {}) {\n\tconst { ctx, control, data } = config;\n\tconst { colors, yAxis, xAxis } = data;\n\tconst chunkScale = config.scaleX;\n\n\tconst draws = {\n\t\titems: [],\n\t\twidth: 0,\n\t\topacity: 1.0,\n\n\t\toffsetIndex: 0,\n\t}\n\n\tlet prevWidth = 0;\n\n\tfunction shouldBulkRecalculate(yAxis) {\n\t\tlet result = false;\n\t\tif (prevWidth !== ctx.canvas.width) {\n\t\t\tprevWidth = ctx.canvas.width;\n\t\t\treturn true;\n\t\t}\n\t\tfor (let i = 0; i < yAxis.items.length; i++) {\n\t\t\tif (result = yAxis.items[i].opacity.inProgress\n\t\t\t\t|| !yAxis.items[i].calculated\n\t\t\t) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tfunction shouldRecalculate(data) {\n\t\treturn true;\n\t}\n\n\tfunction calculate(data, stacked, x, y, width, height) {\n\t\tconst { key, items, opacity } = data;\n\t\tconst normY = data.scaling[normYKey];\n\t\tdraws.opacity = opacity.value;\n\t\t\n\t\tif (!draws.opacity) return;\n\t\tif (draws.opacity < 1) {\n\t\t\tconfig.control.shouldUpdate = true;\n\t\t}\n\n\t\tdraws.items = [];\n\t\tdraws.offsetIndex = 0;\n\t\tdraws.width = chunkScale * width;\n\n\t\tconst WIDTH = (width - draws.width);\n\t\tdraws.width = chunkScale * WIDTH;\n\t\tconst count = items.length;\n\t\tconst chunkSize = chunkScale * WIDTH;\n\t\tconst chunk_2 = chunkSize / 2;\n\t\tconst startBreakpoint = -chunkSize;\n\t\tconst endBreakpoint = ctx.canvas.width + count;\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tstacked[i] += items[i] * draws.opacity;\n\t\t\tconst X = x + chunkSize * i + chunk_2;\n\t\t\tconst Y = y + height - normY(stacked[i]) * height;\n\t\t\tconst BAR_HEIGHT = normY(items[i]) * height * draws.opacity;\n\t\t\t\n\t\t\tif (X < startBreakpoint) {\n\t\t\t\tdraws.offsetIndex++;\n\t\t\t\tcontinue;\n\t\t\t} else if (X > endBreakpoint) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tdraws.items.push([X, Y, Y + BAR_HEIGHT]);\n\t\t}\n\n\t\tdata.calculated = true;\n\t}\n\n\tfunction drawBar(data, stacked, x, y, width, height, activeIndex) {\n\n\t\tconst { key } = data;\n\t\tconst { items, opacity } = draws;\n\n\t\tif (!opacity) return;\n\t\tconst count = items.length;\n\n\t\tctx.save();\n\t\tctx.beginPath();\n\t\tctx.lineWidth = draws.width;\n\t\tctx.strokeStyle = colors[key];\n\t\tfor (let i = 0; i < count; i++) {\n\t\t\tconst isHovered = activeIndex === i + draws.offsetIndex;\n\t\t\tif (isHovered) {\n\t\t\t\tctx.globalAlpha = 0.5;\n\t\t\t\tctx.stroke();\n\t\t\t\tctx.globalAlpha = 1;\n\t\t\t\tctx.beginPath();\n\t\t\t}\n\t\t\tctx.moveTo(items[i][0], items[i][1]);\n\t\t\tctx.lineTo(items[i][0], items[i][2]);\n\t\t\tif (isHovered) {\n\t\t\t\tctx.stroke();\n\t\t\t\tctx.globalAlpha = 0.5;\n\t\t\t\tctx.beginPath();\n\t\t\t}\n\t\t}\n\t\tctx.stroke();\n\t\tctx.restore();\n\t}\n\n\treturn {\n\t\tshouldBulkRecalculate: shouldBulkRecalculate,\n\t\tshouldRecalculate: shouldRecalculate,\n\t\tcalculate: calculate,\n\t\tdraw: drawBar,\n\t};\n}","import { throttle } from '../../utils';\nimport { PI2, ONE, TWO, CURRENT, DOT_RADIUS, PIXEL_RATIO } from '../../Globals';\n\nconst SIDE_LEFT = 1;\nconst SIDE_CENTER = 2;\nconst SIDE_RIGHT = 3;\n\nexport function createMouseDotHandling(config, { paddingLeftSelector, paddingRightSelector, rounding, plus }) {\n\tconst { ctx } = config;\n\tconst mouse = config.mouse.mouse;\n\tconst popup = config.popup;\n\tconst chunkScale = config.scaleX;\n\n\n\tconst current = {\n\t\tx: 0,\n\t\ty: 0,\n\t\twidth: 0,\n\t\theight: 0,\n\n\t\tindexOld: -1,\n\t\tindex: -1,\n\t};\n\n\tconst context = {\n\t\tcount: 0,\n\t\tchunkScale: config.scaleX,\n\t\tchunkSize: chunkScale * current.width,\n\t\tchunkSizeDiv2: chunkScale * current.width / 2,\n\n\t\tonCanvasOld: false,\n\t\tonCanvas: false,\n\t\tpopupSide: 1,\n\n\t\tcurrent: current,\n\t};\n\n\tlet TOUCHED = false;\n\t\n\n\tconst handleOver = throttle((mouse, e) => {\n\t\t// Check if mouse on canvas container\n\t\tcontext.onCanvasOld = context.onCanvas;\n\t\tcontext.onCanvas = (ctx.canvas === e.target || ctx.canvas.nextSibling.contains(e.target));\n\t\tif ((!context.onCanvas && context.onCanvasOld) || e.target.tagName === 'BUTTON') {\n\t\t\tif (current.index !== -1) {\n\t\t\t\tconfig.chart.shouldUpdate = true;\n\t\t\t}\n\t\t\tcurrent.index = -1;\n\t\t\tpopup.hide();\n\t\t}\n\n\t\tif (!context.onCanvas) return;\n\t\tif (e.target !== ctx.canvas) return;\n\n\t\tif (context.onCanvas || (context.onCanvasOld === true && context.onCanvas === false)) {\n\t\t\tcurrent.indexOld = current.index;\n\t\t\tif (mouse.newY > current.y && mouse.newY < current.y + current.height) {\n\t\t\t\tcurrent.index = context.count - rounding((current.width + current.x - mouse.newX) / context.chunkSize + plus);\n\t\t\t\tif (current.index < context.count && current.index >= 0) {\n\t\t\t\t\tpopup.show(current.index);\n\t\t\t\t} else {\n\t\t\t\t\tcurrent.index = -1;\n\t\t\t\t\tpopup.hide();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcurrent.index = -1;\n\t\t\t\tpopup.hide();\n\t\t\t}\n\t\t}\n\n\t\tif (current.indexOld !== current.index) {\n\t\t\tconfig.chart.shouldUpdate = true;\n\n\t\t\tif (current.index !== -1) {\n\t\t\t\tconst popupBounds = popup.element.getBoundingClientRect();\n\t\t\t\tconst currentPos = (current.index * context.chunkSize + current.x) / PIXEL_RATIO;\n\t\t\t\tconst paddingLeft = paddingRightSelector(context) / PIXEL_RATIO;\n\t\t\t\tconst paddingRight = paddingLeftSelector(context) / PIXEL_RATIO;\n\n\t\t\t\tconst leftOverflow = (currentPos + popupBounds.width + paddingRight);\n\t\t\t\tconst rightOverflow = (currentPos - popupBounds.width - paddingRight);\n\t\t\t\tif (leftOverflow > config.canvasBounds.width / PIXEL_RATIO) {\n\t\t\t\t\tcontext.popupSide = SIDE_LEFT;\n\t\t\t\t} else if (rightOverflow < 0) {\n\t\t\t\t\tcontext.popupSide = SIDE_RIGHT;\n\t\t\t\t}\n\n\t\t\t\tif (context.popupSide === SIDE_LEFT) {\n\t\t\t\t\tpopup.element.style.left = `${currentPos - popupBounds.width - paddingLeft}px`;\n\t\t\t\t} else if (context.popupSide === SIDE_RIGHT) {\n\t\t\t\t\tpopup.element.style.left = `${currentPos + paddingRight}px`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcurrent.indexOld = current.index;\n\t\t}\n\t}, 50);\n\n\tconst moveHandler = (mouse, e) => { TOUCHED && handleOver(mouse, e); };\n\tconst downHandler = (mouse, e) => { TOUCHED = true; handleOver(mouse, e); };\n\tconst   upHandler = (mouse, e) => { TOUCHED = false; };\n\n\tcontext.destroy = function destroy() {\n\t\tconfig.mouse.removeListener('move', moveHandler);\n\t\tconfig.mouse.removeListener('down', downHandler);\n\t\tconfig.mouse.removeListener('up', upHandler);\n\n\t\tcurrent.indexOld = -1;\n\t\tcurrent.index = -1;\n\t}\n\n\tcontext.init = function init() {\n\t\tconfig.mouse.addListener('move', moveHandler);\n\t\tconfig.mouse.addListener('down', downHandler);\n\t\tconfig.mouse.addListener('up', upHandler);\n\t}\n\n\tcontext.init();\n\n\treturn context;\n}","import { throttle } from '../../utils';\nimport { CURRENT } from '../../Globals';\n\nimport { createMouseDotHandling } from './utils';\n\n\nexport default function BarDots({ config, normYKey }) {\n\tconst { ctx, control, data } = config;\n\tconst { colors, yAxis, xAxis } = data;\n\tconst h = createMouseDotHandling(\n\t\tconfig,\n\t\t{\n\t\t\tpaddingLeftSelector: (context) => context.chunkSize + (context.chunkSizeDiv2 > 10 ? 10 : context.chunkSizeDiv2),\n\t\t\tpaddingRightSelector: (context) => context.chunkSizeDiv2 > 10 ? 10 : context.chunkSizeDiv2,\n\t\t\trounding: Math.ceil,\n\t\t\tplus: 0\n\t\t}\n\t);\n\n\tfunction destroy() {\n\t\th.destroy();\n\t}\n\n\tfunction init() {\n\t\th.init();\n\t}\n\n\tfunction drawBarDots(items, stacked, x, y, width, height) {\n\t\th.current.width = width;\n\t\th.current.height = height;\n\t\th.current.x = x;\n\t\th.current.y = y;\n\n\t\tconst WIDTH = width - h.chunkSize;\n\n\t\th.count = items.length;\n\t\th.chunkSize = h.chunkScale * WIDTH;\n\t\th.chunkSizeDiv2 = h.chunkSize / 2;\n\n\t\treturn h.current.index;\n\t}\n\n\tdrawBarDots.destroy = destroy;\n\tdrawBarDots.init = init;\n\n\treturn drawBarDots;\n}","import {\n\tFONT,\n\tCURRENT,\n\tPIXEL_RATIO,\n\tY_AXIS_TEXT_PADDING,\n} from '../../Globals';\nimport { formatNumber } from '../../utils';\n\n\nexport default function YAxis({ config }, opts = {}) {\n\tconst { ctx, control, data } = config;\n\tconst { colors, yAxis, xAxis } = data;\n\tconst partsCount = 6;\n\tconst textAlign = opts.textAlign || 'left';\n\t\n\treturn function drawYAxis(data, x, y, width, height, drawLine, separateAxis) {\n\t\tconst min = Math.round(data.scaling.minHeightAnim.value);\n\t\tconst max = Math.round(data.scaling.maxHeightAnim.value);\n\t\tconst opacity = data.opacity.value;\n\t\tconst a = height / partsCount;\n\t\tconst part = (height + a/2) / partsCount;\n\t\tconst partNumber = Math.ceil((max - min) / partsCount);\n\n\t\tctx.save();\n\t\tctx.beginPath();\n\n\t\t// ctx.fillStyle = '#182D3B';\n\t\tctx.fillStyle = data.scaling.color || CURRENT.THEME.gridLines;\n\t\tif (separateAxis) {\n\t\t\tctx.globalAlpha = opacity / 2;\n\t\t} else {\n\t\t\tctx.globalAlpha = data.scaling.color ? 0.8 : 0.5;\n\t\t}\n\n\t\tctx.font = FONT;\n\t\tctx.textBaseline = 'bottom';\n\t\tctx.textAlign = textAlign;\n\t\tfor (let i = 0; i < partsCount; i++) {\n\t\t\tif (drawLine) {\n\t\t\t\tctx.moveTo(x, y + height - i * part);\n\t\t\t\tctx.lineTo(x + width, y + height - i * part);\n\t\t\t}\n\t\t\tconst number = formatNumber(min + partNumber * i, true);\n\t\t\tctx.fillText(number, x + 3, y + height - i * part - Y_AXIS_TEXT_PADDING);\n\t\t}\n\n\t\tctx.lineWidth = 1 * PIXEL_RATIO;\n\t\tif (drawLine) {\n\t\t\tctx.globalAlpha = 0.1;\n\t\t\t// ctx.strokeStyle = '#182D3B';\n\t\t\tctx.strokeStyle = CURRENT.THEME.gridLines;\n\t\t\tctx.stroke();\n\t\t}\n\t\tctx.restore();\n\t}\n}","import { memo, normalize, normalizeMemo } from '../../utils';\nimport {\n\tFONT,\n\tCURRENT,\n\tAXIS_TEXT_WIDTH,\n\tX_AXIS_HEIGHT_DIV_2,\n\tAXIS_TEXT_WIDTH_DIV_2,\n} from '../../Globals';\n\n\nconst steps = [0, 1, 2, 4, 4, 8, 8, 8, 8, 16, 16, 16, 16, 16, 16, 16, 16, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 32, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64, 64];\n\nexport default function XAxis({ config, forBars }) {\n\tconst { ctx, control, data } = config;\n\tconst { colors, yAxis, xAxis } = data;\n\tlet deepness = 0;\n\tconst chunkScale = config.scaleX;\n\tlet chunkSize = 0;\n\n\treturn function drawXAxis(items, x, y, width, height) {\n\t\tconst count = items.length;\n\t\tif (forBars) {\n\t\t\tchunkSize = chunkScale * (width - chunkScale * width);\n\t\t} else {\n\t\t\tchunkSize = chunkScale * width;\n\t\t}\n\n\t\tif (forBars) {\n\t\t\twidth = width - chunkSize;\n\t\t}\n\n\t\tctx.save();\n\n\t\t// ctx.fillStyle = '#182D3B'\n\t\tctx.fillStyle = CURRENT.THEME.gridLines;\n\t\tctx.font = FONT;\n\t\tctx.textAlign = 'center';\n\t\tctx.textBaseline = 'middle';\n\t\tctx.globalAlpha = 0.5;\n\n\t\tconst currRaw = width * chunkScale;\n\t\tconst curr = Math.floor(currRaw);\n\t\tconst step = Math.ceil(AXIS_TEXT_WIDTH / currRaw);\n\t\tconst nextStep = step + 1;\n\t\tconst realStep = steps[step];\n\t\tconst nextRealStep = steps[nextStep];\n\n\t\tconst breakPoint = currRaw;\n\t\tconst currItemWidth = AXIS_TEXT_WIDTH / step;\n\t\tconst fade = breakPoint / currItemWidth;\n\t\tconst alpha = (fade - 1) * (step);\n\n\t\tfor (let i = 0; i < count; i += realStep) {\n\t\t\tconst ost = i % nextRealStep;\n\t\t\tif (ost === 0) {\n\t\t\t\tctx.globalAlpha = 0.5;\n\t\t\t} else {\n\t\t\t\tif (alpha > 0.5) {\n\t\t\t\t\tctx.globalAlpha = 0.5;\n\t\t\t\t} else {\n\t\t\t\t\tctx.globalAlpha = alpha;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst X = x + (forBars ? chunkSize / 2 : 0) + chunkSize * i;\n\t\t\tconst Y = y + X_AXIS_HEIGHT_DIV_2;\n\t\t\tif (X < -AXIS_TEXT_WIDTH || X > ctx.canvas.width + AXIS_TEXT_WIDTH) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tctx.fillText(items[i].dayString, X, Y);\n\t\t}\n\n\t\tctx.restore();\n\t}\n}","import {\n\tPIXEL_RATIO,\n\tBOTTOM_PADDING,\n\tX_AXIS_HEIGHT,\n\tONE,\n\tTWO,\n\tDOT_RADIUS,\n\tDOT_RADIUS_DIV_2,\n\tDOT_RADIUS_MUL_2,\n} from '../../Globals';\n\nimport BarLayerDrawer from '../Layers/Bar';\nimport BarActivePopup from '../Layers/BarActivePopup';\nimport YAxisLayerDrawer from '../Layers/YAxis';\nimport XAxisLayerDrawer from '../Layers/XAxis';\n\nimport { debugLayer } from '../utils';\n\n\nexport default function BarChartDrawer(drawersArgs) {\n\tconst { config } = drawersArgs;\n\tconst { ctx, data } = config;\n\tconst { colors, yAxis, xAxis } = data;\n\tconst chartPadding = 6 * PIXEL_RATIO;\n\tconst chartPadding2 = chartPadding * 2;\n\n\tconst drawBarLayer  = BarLayerDrawer(drawersArgs);\n\tconst calculateActiveBarIndex  = BarActivePopup(drawersArgs);\n\tconst drawXAxisLayer = XAxisLayerDrawer({...drawersArgs, forBars: true});\n\tconst drawYAxisLayer = YAxisLayerDrawer(drawersArgs, {\n\t\ttextAlign: 'left',\n\t});\n\n\tfunction destroy() {\n\t\tcalculateActiveBarIndex.destroy();\n\t}\n\n\tfunction init() {\n\t\tcalculateActiveBarIndex.init();\n\t}\n\n\tfunction drawChart(x, y, width, height) {\n\t\t// debugLayer(ctx, x, y, width, height);\n\n\t\tconst XS = width * config.control.range[0];\n\t\tconst xRanged = x - XS / config.control.scale;\n\t\tconst widthRanged = width / config.control.scale;\n\n\t\tconst HEIGHT = height - BOTTOM_PADDING - DOT_RADIUS_MUL_2;\n\t\tconst Y = y + TWO;\n\n\t\t// Draw layers\n\t\tconst stacked = new Array(xAxis.length).fill(0);\n\t\tconst currentActiveIndex = calculateActiveBarIndex(xAxis, stacked, xRanged, Y, widthRanged, HEIGHT - X_AXIS_HEIGHT);\n\t\tfor (let i = 0; i < yAxis.items.length; i++) {\n\t\t\tdrawBarLayer.calculate(yAxis.items[i], stacked, xRanged, Y, widthRanged, HEIGHT - X_AXIS_HEIGHT);\n\t\t\tdrawBarLayer.draw(yAxis.items[i], stacked, xRanged, Y, widthRanged, HEIGHT - X_AXIS_HEIGHT, currentActiveIndex);\n\t\t}\n\t\t\n\t\tdrawXAxisLayer(xAxis, xRanged, y + HEIGHT - X_AXIS_HEIGHT, widthRanged, X_AXIS_HEIGHT);\n\t\tdrawYAxisLayer(yAxis.items[0], x, Y, width, HEIGHT - X_AXIS_HEIGHT, true);\n\t}\n\n\tdrawChart.destroy = destroy;\n\tdrawChart.init = init;\n\n\treturn drawChart;\n}","import { PIXEL_RATIO, CURRENT, ONE } from '../../Globals';\n\nexport const NONE = 0;\nexport const DRAG_START = 1;\nexport const DRAG_END = 2;\nexport const DRAG_ALL = 3;\n\nexport const pipaH = 10 * PIXEL_RATIO;\nexport const pipaH2 = pipaH / 2;\nexport const controlWidth = 10 * PIXEL_RATIO;\nexport const controlWidthMul2 = controlWidth * 2;\nexport const controlWidthDiv2 = controlWidth / 2;\nexport const controlWidthDiv13 = controlWidth - controlWidth / 3;\nexport const controlPipaWidth = 2 * PIXEL_RATIO;\nexport const controlPipaPos = (controlWidth - controlPipaWidth) / 2;\n\n\nexport function createControlLayer(config) {\n\tconst OPTS = {\n\t\tcontrolsBounds: {\n\t\t\tstart: {\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\twidth: 0,\n\t\t\t\theight: 0,\n\t\t\t},\n\t\t\tend: {\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\twidth: 0,\n\t\t\t\theight: 0,\n\t\t\t},\n\t\t}\n\t};\n\tconst controlsBounds = OPTS.controlsBounds;\n\n\tlet mouseMode = NONE;\n\t// let oldRange = [config.control.range[0], config.control.range[1]];\n\tlet oldRange = [0, 0];\n\tconst clickRangeBase = 14 * PIXEL_RATIO;\n\n\tlet xs = 0;\n\tlet xe = 0;\n\tlet ww = xe - xs;\n\n\tlet oldWidth = 0;\n\tlet oldX = 0;\n\n\tfunction mouseMove(mouse) {\n\t\tif (mouseMode === NONE) return;\n\t\tconfig.chart.shouldUpdate = true;\n\t\tconfig.control.shouldUpdate = true;\n\n\t\tconst norm = config.normalizeForControl(mouse.newX);\n\t\tconst normOld = config.normalizeForControl(mouse.x);\n\t\tconst diff = (norm - normOld);\n\n\t\tconst newRangeStart = oldRange[0] + diff;\n\t\tconst newRangeEnd = oldRange[1] + diff;\n\t\tif (mouseMode === DRAG_START) {\n\t\t\tif (newRangeStart > 0) {\n\t\t\t\tconfig.control.updateRange(newRangeStart, oldRange[1]);\n\t\t\t} else {\n\t\t\t\tconfig.control.updateRange(0, oldRange[1]);\n\t\t\t}\n\t\t} else if (mouseMode === DRAG_END) {\n\t\t\tif (newRangeEnd < 1) {\n\t\t\t\tconfig.control.updateRange(oldRange[0], newRangeEnd);\n\t\t\t} else {\n\t\t\t\tconfig.control.updateRange(oldRange[0], 1);\n\t\t\t}\n\t\t} else {\n\t\t\tif (newRangeStart >= 0 && newRangeEnd <= 1) {\n\t\t\t\tconfig.control.updateRange(newRangeStart, newRangeEnd);\n\t\t\t} else {\n\t\t\t\tif (newRangeEnd > 1) {\n\t\t\t\t\tlet diff = 1 - oldRange[1];\n\t\t\t\t\tconfig.control.updateRange(oldRange[0] + diff, oldRange[1] + diff);\n\t\t\t\t} else if (newRangeStart < 0) {\n\t\t\t\t\tlet diff = 0 - oldRange[0];\n\t\t\t\t\tconfig.control.updateRange(oldRange[0] + diff, oldRange[1] + diff);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction mouseDown(mouse) {\n\t\tconst clickRange = clickRangeBase;\n\t\tconst clickRangeStart = clickRangeBase;\n\t\tconst clickRangeEnd = clickRangeBase;\n\n\t\tconst boundsStart = controlsBounds.start;\n\t\tconst boundsEnd = controlsBounds.end;\n\t\tconst inControl = mouse.y > boundsStart.y && mouse.y < boundsStart.y + boundsStart.height;\n\t\tif (!inControl) return;\n\t\tconfig.chart.shouldUpdate = true;\n\t\tconfig.control.shouldUpdate = true;\n\t\t\n\t\toldRange = [config.control.range[0], config.control.range[1]];\n\t\tif (mouse.newX > boundsStart.x - clickRangeStart && mouse.newX < boundsStart.x + boundsStart.width && mouse.newY > boundsStart.y - clickRangeStart && mouse.newY < boundsStart.y + boundsStart.height + clickRangeStart) {\n\t\t\tmouseMode = DRAG_START;\n\t\t} else if (mouse.newX > boundsEnd.x && mouse.newX < boundsEnd.x + boundsEnd.width + clickRangeEnd && mouse.newY > boundsEnd.y - clickRangeEnd && mouse.newY < boundsEnd.y + boundsEnd.height + clickRangeEnd) {\n\t\t\tmouseMode = DRAG_END;\n\t\t} else if (mouse.newX > boundsStart.x + boundsStart.width && mouse.newX < boundsEnd.x && mouse.newY > boundsEnd.y - clickRangeBase && mouse.newY < boundsEnd.y + boundsEnd.height + clickRangeBase) {\n\t\t\tmouseMode = DRAG_ALL;\n\t\t}\n\t}\n\n\tfunction mouseUp(mouse) {\n\t\tmouseMode = NONE;\n\t}\n\n\n\tfunction init() {\n\t\tconfig.mouse.addListener('move', mouseMove);\n\t\tconfig.mouse.addListener('down', mouseDown);\n\t\tconfig.mouse.addListener('up', mouseUp);\n\t}\n\n\tfunction destroy() {\n\t\tconfig.mouse.removeListener('move', mouseMove);\n\t\tconfig.mouse.removeListener('down', mouseDown);\n\t\tconfig.mouse.removeListener('up', mouseUp);\n\t}\n\n\tfunction updateControlBounds(x, width) {\n\t\toldWidth = width;\n\t\toldX = x;\n\t}\n\n\tfunction renderControl(ctx, x, y, width, height) {\n\t\txs = x + width * config.control.range[0];\n\t\txe = x + width * config.control.range[1];\n\t\tww = xe - xs;\n\n\t\tcontrolsBounds.start.x = xs - controlWidth;\n\t\tcontrolsBounds.start.y = y;\n\t\tcontrolsBounds.start.width = controlWidth;\n\t\tcontrolsBounds.start.height = height;\n\n\t\tcontrolsBounds.end.x = xe;\n\t\tcontrolsBounds.end.y = y;\n\t\tcontrolsBounds.end.width = controlWidth;\n\t\tcontrolsBounds.end.height = height;\n\n\t\t// Fill unactive part\n\t\tctx.save();\n\t\tctx.globalAlpha = 0.6;\n\t\t// ctx.fillStyle = \"#E2EEF9\";\n\t\tctx.fillStyle = CURRENT.THEME.scrollBackground;\n\n\t\tctx.beginPath();\n\t\tctx.moveTo(xs - 1, y);\n\t\tctx.lineTo(xs - 1, y + height);\n\t\tctx.arcTo(oldX, y + height, oldX, y + height - controlWidth, controlWidthDiv2);\n\t\tctx.arcTo(oldX, y, xs - 1, y, controlWidthDiv2);\n\t\tctx.closePath();\n\t\tctx.fill();\n\n\t\tctx.beginPath();\n\t\tctx.moveTo(xe + 1, y);\n\t\tctx.lineTo(xe + 1, y + height);\n\t\tctx.arcTo(oldX + oldWidth, y + height, oldX + oldWidth, y + height - controlWidth, controlWidthDiv2);\n\t\tctx.arcTo(oldX + oldWidth, y, xe, y, controlWidthDiv2);\n\t\tctx.closePath();\n\t\tctx.fill();\n\n\t\tctx.restore();\n\t\t// End fill unactive part\n\n\n\t\t// Range body\n\t\tctx.save();\n\t\t// ctx.fillStyle = \"#C0D1E1\";\n\t\tctx.fillStyle = CURRENT.THEME.scrollSelector;\n\t\tctx.beginPath();\n\t\tctx.rect(xs, y, ww, ONE);\n\t\tctx.rect(xs, y + height - ONE, ww, ONE);\n\t\tctx.fill();\n\n\n\t\t// Start range\n\t\tctx.beginPath();\n\t\tconst xxxs = xs;\n\t\tctx.moveTo(xxxs, y);\n\t\tctx.lineTo(xxxs, y + height);\n\t\tctx.arcTo(xxxs - controlWidth, y + height, xxxs - controlWidth, y + height - controlWidth, controlWidthDiv13);\n\t\tctx.arcTo(xxxs - controlWidth, y, xxxs, y, controlWidthDiv13);\n\t\tctx.closePath();\n\t\tctx.fill();\n\n\t\t// End range\n\t\tctx.beginPath();\n\t\tctx.moveTo(xe, y);\n\t\tctx.lineTo(xe, y + height);\n\t\tctx.arcTo(xe + controlWidth, y + height, xe + controlWidth, y + height - controlWidth, controlWidthDiv13);\n\t\tctx.arcTo(xe + controlWidth, y, xe, y, controlWidthDiv13);\n\t\tctx.closePath();\n\t\tctx.fill();\n\n\t\tctx.restore();\n\n\t\tctx.save();\n\t\tctx.beginPath();\n\t\tctx.fillStyle = \"#FFFFFF\";\n\t\tctx.rect(xs - controlPipaPos, y + height/2 - pipaH2, -controlPipaWidth, pipaH);\n\t\tctx.rect(xe + controlPipaPos, y + height/2 - pipaH2, controlPipaWidth, pipaH);\n\t\tctx.fill();\n\t\tctx.restore();\n\t}\n\n\n\tOPTS.updateControlBounds = updateControlBounds;\n\tOPTS.renderControl = renderControl;\n\tOPTS.destroy = destroy;\n\tOPTS.init = init;\n\n\tinit();\n\n\treturn OPTS;\n}","import { PIXEL_RATIO, ONE, CURRENT } from '../../Globals';\nimport BarLayerDrawer from '../Layers/Bar';\nimport { debugLayer } from '../utils';\nimport { createControlLayer, controlWidthMul2, controlWidth } from './utils';\n\n\nexport default function ControlsDrawer(drawersArgs) {\n\tconst { config } = drawersArgs;\n\tconst { ctx, data } = config;\n\tconst { colors, yAxis, xAxis } = data;\n\tconst  barLayers = yAxis.items.map(el => BarLayerDrawer(drawersArgs));\n\tconst { updateControlBounds, renderControl, destroy: destroyControl, init: initControl } = createControlLayer(config);\n\t\n\tfunction destroy() {\n\t\tdestroyControl();\n\t}\n\n\tfunction init() {\n\t\tinitControl();\n\t}\n\n\t\n\tconst stacked = new Array(xAxis.length);\n\tfunction drawControl(x, y, width, height) {\n\t\t// debugLayer(ctx, x, y, width, height);\n\t\t\n\t\tupdateControlBounds(x, width);\n\t\twidth = width - controlWidthMul2;\n\t\tx = x + controlWidth;\n\n\t\tstacked.fill(0);\n\t\tconst shouldRecalculate = barLayers[0].shouldBulkRecalculate(yAxis);\n\n\t\tfor (let i = 0; i < yAxis.items.length; i++) {\n\t\t\tif (shouldRecalculate) {\n\t\t\t\tbarLayers[i].calculate(yAxis.items[i], stacked, x, y + 3, width, height - 6);\n\t\t\t}\n\t\t\tbarLayers[i].draw(yAxis.items[i], x, y + 3, width, height - 6);\n\t\t}\n\n\t\trenderControl(ctx, x, y, width, height);\n\t}\n\n\tdrawControl.destroy = destroy;\n\tdrawControl.init = init;\n\n\treturn drawControl;\n}","import { PIXEL_RATIO, CURRENT, DOT_RADIUS, PI2 } from '../../Globals';\n\n\nexport default function Line({ config, normYKey }, opts = {}) {\n\tconst { ctx, control, data } = config;\n\tconst { colors, yAxis, xAxis } = data;\n\tconst lineWidth = (opts.lineWidth || 2) * PIXEL_RATIO;\n\tconst chunkScale = config.scaleX;\n\n\tconst draws = {\n\t\titems: [],\n\t\topacity: 1.0,\n\n\t\toffsetIndex: 0,\n\t};\n\n\tlet prevWidth = 0;\n\n\tfunction shouldBulkRecalculate(datas) {\n\t\treturn true;\n\t}\n\n\tfunction shouldRecalculate(data) {\n\t\tconst result = (\n\t\t\tdata.opacity.inProgress\n\t\t\t|| !data.calculated\n\t\t\t|| ctx.canvas.width !== prevWidth\n\t\t);\n\t\tprevWidth = ctx.canvas.width;\n\t\treturn result;\n\t}\n\n\tfunction calculate(data, x, y, width, height) {\n\t\tconst { key, items, opacity } = data;\n\t\tconst normY = data.scaling[normYKey];\n\t\tconst currOpacity = opacity.value;\n\t\tdraws.opacity = opacity.value;\n\n\t\tif (!currOpacity) return;\n\t\tif (currOpacity < 1) {\n\t\t\tconfig.control.shouldUpdate = true;\n\t\t}\n\n\t\tdraws.items = [];\n\t\tdraws.offsetIndex = 0;\n\n\t\tconst count = items.length;\n\t\tconst chunkSize = chunkScale * width;\n\t\tconst yh = y + height;\n\n\t\tconst startBreakpoint = -chunkSize;\n\t\tconst endBreakpoint = ctx.canvas.width + chunkSize;\n\n\t\tdraws.items.push([x + 0, yh - normY(items[0]) * height]);\n\n\t\tfor (let i = 1; i < count; i++) {\n\t\t\tconst X = x + chunkSize * i;\n\t\t\tconst Y = yh - normY(items[i]) * height;\n\t\t\tif (Y > yh) {\n\t\t\t\tconfig.control.shouldUpdate = true;\n\t\t\t}\n\t\t\tif (X < startBreakpoint) {\n\t\t\t\tdraws.offsetIndex++;\n\t\t\t\tcontinue;\n\t\t\t} else if (X > endBreakpoint) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tdraws.items.push([X, Y]);\n\t\t}\n\n\t\tdata.calculated = true;\n\t}\n\n\tfunction drawLine(data, x, y, width, height) {\n\t\tconst { items, opacity } = draws;\n\t\tconst { key } = data;\n\n\t\tif (!opacity) return;\n\t\tconst count = items.length;\n\n\t\tctx.save();\n\t\tctx.beginPath();\n\t\tctx.moveTo(items[0][0], items[0][1]);\n\t\tfor (let i = 1; i < count; i++) {\n\t\t\tctx.lineTo(items[i][0], items[i][1]);\n\t\t}\n\t\tctx.lineWidth = lineWidth;\n\t\tctx.strokeStyle = colors[key];\n\t\tctx.globalAlpha = opacity;\n\t\tctx.lineJoin = 'round';\n\t\tctx.stroke();\n\t\tctx.restore();\n\t}\n\n\treturn {\n\t\tdraws: draws,\n\t\tshouldBulkRecalculate: shouldBulkRecalculate,\n\t\tshouldRecalculate: shouldRecalculate,\n\t\tcalculate: calculate,\n\t\tdraw: drawLine,\n\t}\n}","import { throttle } from '../../utils';\nimport { PI2, TWO, CURRENT, DOT_RADIUS } from '../../Globals';\n\nimport { createMouseDotHandling } from './utils';\n\n\nexport default function LineDots({ config, normYKey }) {\n\tconst { ctx, control, data } = config;\n\tconst { colors, yAxis, xAxis } = data;\n\tconst h = createMouseDotHandling(\n\t\tconfig,\n\t\t{\n\t\t\tpaddingLeftSelector: (context) => DOT_RADIUS,\n\t\t\tpaddingRightSelector: (context) => DOT_RADIUS,\n\t\t\trounding: Math.round,\n\t\t\tplus: 1,\n\t\t}\n\t);\n\n\tfunction destroy() {\n\t\th.destroy();\n\t}\n\n\tfunction init() {\n\t\th.init();\n\t}\n\n\tfunction drawLineDots(items, x, y, width, height) {\n\t\th.current.width = width;\n\t\th.current.height = height;\n\t\th.current.x = x;\n\t\th.current.y = y;\n\n\t\th.count = items.length;\n\t\th.chunkSize = h.chunkScale * width;\n\t\t// chunkSizeDiv2 = chunkSize / 2;\n\n\t\treturn h.current.index;\n\t}\n\n\tdrawLineDots.destroy = destroy;\n\tdrawLineDots.init = init;\n\n\treturn drawLineDots;\n}","import {\n\tPIXEL_RATIO,\n\tBOTTOM_PADDING,\n\tX_AXIS_HEIGHT,\n\tCURRENT,\n\tPI2,\n\tONE,\n\tTWO,\n\tDOT_RADIUS,\n\tDOT_RADIUS_DIV_2,\n\tDOT_RADIUS_MUL_2,\n} from '../../Globals';\n\nexport function drawDotsForLines({ config }, y, height, activeIndex, drawLineLayers) {\n\tconst { ctx, data } = config;\n\tconst { colors, yAxis, xAxis } = data;\n\tfor (let i = 0; i < yAxis.items.length; i++ ) {\n\t\tconst { key } = yAxis.items[i];\n\t\tconst { draws } = drawLineLayers[i];\n\t\tconst itemsIndex = activeIndex - draws.offsetIndex;\n\t\tif (draws.items[itemsIndex]) {\n\t\t\tconst [ X, Y ] = draws.items[itemsIndex];\n\t\t\tctx.save();\n\t\t\tctx.strokeStyle = CURRENT.THEME.gridLines;\n\t\t\tctx.lineWidth = 1;\n\t\t\tctx.globalAlpha = 0.1;\n\t\t\tctx.beginPath();\n\t\t\tctx.moveTo(X, y);\n\t\t\tctx.lineTo(X, y + height);\n\t\t\tctx.stroke();\n\t\t\tctx.restore();\n\n\t\t\tctx.save();\n\t\t\tctx.beginPath();\n\t\t\tctx.arc(X, Y, DOT_RADIUS, 0, PI2);\n\t\t\tctx.fillStyle = CURRENT.THEME.background;\n\t\t\tctx.lineWidth = TWO;\n\t\t\tctx.globalAlpha = draws.opacity;\n\t\t\tctx.strokeStyle = colors[key];\n\t\t\tctx.fill();\n\t\t\tctx.stroke();\n\t\t\tctx.restore();\n\t\t}\n\t}\n}","import {\n\tPIXEL_RATIO,\n\tBOTTOM_PADDING,\n\tX_AXIS_HEIGHT,\n\tCURRENT,\n\tPI2,\n\tONE,\n\tTWO,\n\tDOT_RADIUS,\n\tDOT_RADIUS_DIV_2,\n\tDOT_RADIUS_MUL_2,\n} from '../../Globals';\n\nimport LineLayerDrawer from '../Layers/Line';\nimport LineActivePopup from '../Layers/LineActivePopup';\nimport YAxisLayerDrawer from '../Layers/YAxis';\nimport XAxisLayerDrawer from '../Layers/XAxis';\nimport { drawDotsForLines } from './utils';\n\nimport { debugLayer } from '../utils';\n\n\nexport default function DualLineChartDrawer(drawersArgs) {\n\tconst { config } = drawersArgs;\n\tconst { ctx, data } = config;\n\tconst { colors, yAxis, xAxis } = data;\n\n\tconst drawLeftYAxisLayer = YAxisLayerDrawer(drawersArgs, {\n\t\ttextAlign: 'left',\n\t});\n\n\tconst drawRightYAxisLayer = YAxisLayerDrawer(drawersArgs, {\n\t\ttextAlign: 'right',\n\t});\n\n\tconst drawXAxisLayer = XAxisLayerDrawer(drawersArgs);\n\t// const drawLineLayer  = LineLayerDrawer(drawersArgs);\n\tconst drawLineLayers = yAxis.items.map(el => LineLayerDrawer(drawersArgs));\n\tconst calculateLineActivePopupIndex  = LineActivePopup(drawersArgs);\n\n\tfunction destroy() {\n\t\tcalculateLineActivePopupIndex.destroy();\n\t}\n\n\tfunction init() {\n\t\tcalculateLineActivePopupIndex.init();\n\t}\n\n\tfunction drawChart(x, y, width, height) {\n\t\t// debugLayer(ctx, x, y, width, height);\n\n\t\tconst XS = width * config.control.range[0];\n\t\tconst xRanged = x - XS / config.control.scale;\n\t\tconst widthRanged = width / config.control.scale;\n\n\t\tconst HEIGHT = height - BOTTOM_PADDING - DOT_RADIUS_MUL_2;\n\t\tconst Y = y + DOT_RADIUS + TWO;\n\n\t\t// Draw layers\n\t\tdrawXAxisLayer(xAxis, xRanged, y + HEIGHT - X_AXIS_HEIGHT, widthRanged, X_AXIS_HEIGHT);\n\n\t\tlet drawYLine = true;\n\t\tif (yAxis.items[0].enabled) {\n\t\t\tdrawLeftYAxisLayer(yAxis.items[0], x, Y, width, HEIGHT - X_AXIS_HEIGHT, drawYLine);\n\t\t\tdrawYLine = false;\n\t\t}\n\t\tif (yAxis.items[1].enabled) {\n\t\t\tdrawRightYAxisLayer(yAxis.items[1], x + width, Y, -width, HEIGHT - X_AXIS_HEIGHT, drawYLine);\n\t\t\tdrawYLine = false;\n\t\t}\n\n\t\tconst activeIndex = calculateLineActivePopupIndex(xAxis, xRanged, Y, widthRanged, HEIGHT - X_AXIS_HEIGHT);\n\t\tfor (let i = 0; i < yAxis.items.length; i++ ) {\n\t\t\tdrawLineLayers[i].calculate(yAxis.items[i], xRanged, Y, widthRanged, HEIGHT - X_AXIS_HEIGHT);\n\t\t\tdrawLineLayers[i].draw(yAxis.items[i], xRanged, Y, widthRanged, HEIGHT - X_AXIS_HEIGHT, activeIndex);\n\t\t}\n\n\t\tdrawDotsForLines(drawersArgs, y, height, activeIndex, drawLineLayers);\n\t}\n\n\tdrawChart.destroy = destroy;\n\tdrawChart.init = init;\n\n\treturn drawChart;\n}","import {\n\tPIXEL_RATIO,\n\tBOTTOM_PADDING,\n\tX_AXIS_HEIGHT,\n\tCURRENT,\n\tPI2,\n\tONE,\n\tTWO,\n\tDOT_RADIUS,\n\tDOT_RADIUS_DIV_2,\n\tDOT_RADIUS_MUL_2,\n} from '../../Globals';\n\nimport LineLayerDrawer from '../Layers/Line';\nimport LineActivePopupLayer from '../Layers/LineActivePopup';\nimport YAxisLayerDrawer from '../Layers/YAxis';\nimport XAxisLayerDrawer from '../Layers/XAxis';\nimport { drawDotsForLines } from './utils';\n\nimport { debugLayer } from '../utils';\n\n\nexport default function LineChartDrawer(drawersArgs) {\n\tconst { config } = drawersArgs;\n\tconst { ctx, data } = config;\n\tconst { colors, yAxis, xAxis } = data;\n\tconst chartPadding = 6 * PIXEL_RATIO;\n\tconst chartPadding2 = chartPadding * 2;\n\n\t// const drawLineLayer = LineLayerDrawer(drawersArgs);\n\tconst drawLineLayers = yAxis.items.map(el => LineLayerDrawer(drawersArgs));\n\tconst calculateLineActivePopupIndex = LineActivePopupLayer(drawersArgs);\n\tconst drawXAxisLayer = XAxisLayerDrawer(drawersArgs);\n\tconst drawYAxisLayer = YAxisLayerDrawer(drawersArgs, {\n\t\ttextAlign: 'left',\n\t});\n\n\tfunction destroy() {\n\t\tcalculateLineActivePopupIndex.destroy();\n\t}\n\n\tfunction init() {\n\t\tcalculateLineActivePopupIndex.init();\n\t}\n\n\tfunction drawChart(x, y, width, height) {\n\t\t// debugLayer(ctx, x, y, width, height);\n\n\t\tconst XS = width * config.control.range[0];\n\t\tconst xRanged = x - XS / config.control.scale;\n\t\tconst widthRanged = width / config.control.scale;\n\n\t\tconst HEIGHT = height - BOTTOM_PADDING - DOT_RADIUS_MUL_2;\n\t\tconst Y = y + DOT_RADIUS + TWO;\n\n\t\t// Draw layers\n\t\tdrawXAxisLayer(xAxis, xRanged, y + HEIGHT - X_AXIS_HEIGHT, widthRanged, X_AXIS_HEIGHT);\n\t\tdrawYAxisLayer(yAxis.items[0], x, Y, width, HEIGHT - X_AXIS_HEIGHT, true);\n\t\tfor (let i = 0; i < yAxis.items.length; i++ ) {\n\t\t\tdrawLineLayers[i].calculate(yAxis.items[i], xRanged, Y, widthRanged, HEIGHT - X_AXIS_HEIGHT);\n\t\t\tdrawLineLayers[i].draw(yAxis.items[i], xRanged, Y, widthRanged, HEIGHT - X_AXIS_HEIGHT);\n\t\t}\n\n\t\tconst activeIndex = calculateLineActivePopupIndex(xAxis, xRanged, Y, widthRanged, HEIGHT - X_AXIS_HEIGHT);\n\t\tdrawDotsForLines(drawersArgs, y, height, activeIndex, drawLineLayers);\n\t}\n\n\tdrawChart.destroy = destroy;\n\tdrawChart.init = init;\n\n\treturn drawChart;\n}","import { PIXEL_RATIO, ONE, CURRENT } from '../../Globals';\nimport LineLayerDrawer from '../Layers/Line';\nimport { debugLayer } from '../utils';\nimport { createControlLayer, controlWidthMul2, controlWidth } from './utils';\n\n\nexport default function ControlsDrawer(drawersArgs) {\n\tconst { config } = drawersArgs;\n\tconst { ctx, data } = config;\n\tconst { colors, yAxis, xAxis } = data;\n\tconst lineLayers = yAxis.items.map(el => LineLayerDrawer(drawersArgs, { lineWidth: 1 }));\n\tconst { updateControlBounds, renderControl, destroy: destroyControl, init: initControl } = createControlLayer(config);\n\t\n\tfunction destroy() {\n\t\tdestroyControl();\n\t}\n\n\tfunction init() {\n\t\tinitControl();\n\t}\n\n\n\tfunction drawControl(x, y, width, height) {\n\t\t// debugLayer(ctx, x, y, width, height);\n\n\t\tupdateControlBounds(x, width);\n\t\twidth = width - controlWidthMul2;\n\t\tx = x + controlWidth;\n\n\t\tfor (let i = 0; i < yAxis.items.length; i++ ) {\n\t\t\tif (lineLayers[i].shouldRecalculate(yAxis.items[i])) {\n\t\t\t\tlineLayers[i].calculate(yAxis.items[i], x, y + 3, width, height - 6);\n\t\t\t}\n\t\t\tlineLayers[i].draw(yAxis.items[i], x, y + 3, width, height - 6);\n\t\t}\n\n\t\trenderControl(ctx, x, y, width, height);\n\t}\n\n\tdrawControl.destroy = destroy;\n\tdrawControl.init = init;\n\n\treturn drawControl;\n}","import { PIXEL_RATIO, PI1, FONT } from '../../Globals';\n\n\nexport default function Area({ config, normYKey }, opts = {}) {\n\tconst { ctx, control, data } = config;\n\tconst { colors, yAxis, xAxis } = data;\n\tconst lineWidth = 2 * PIXEL_RATIO;\n\tconst mouse = config.mouse.mouse;\n\tconst popup = config.popup;\n\tconst chunkScale = config.scaleX;\n\n\tlet currentWidth = 0;\n\tlet currentHeight = 0;\n\tlet currentX = 0;\n\tlet currentY = 0;\n\tlet RADIUS = 0;\n\tlet centerX = 0;\n\tlet centerY = 0;\n\n\t// config.mouse.addListener('down', function down(mouse, e) {\n\t// \tif (e.target !== ctx.canvas) return;\n\t// \tconsole.log('G+HEY', Math.round(mouse.newX), Math.round(mouse.newY));\n\t// \tconfig.chart.shouldUpdate = true;\n\t// });\n\n\tfunction calculate(data, perc, start, end, x, y, width, height) {\n\t\t\n\t}\n\n\tfunction drawArea(data, perc, start, end, x, y, width, height) {\n\t\tconst { key, items, opacity } = data;\n\t\tconst copacity = opacity.value;\n\n\t\tcurrentWidth = width;\n\t\tcurrentHeight = height;\n\t\tcurrentX = x;\n\t\tcurrentY = y;\n\n\t\tif (!copacity) return;\n\t\tif (copacity < 1) {\n\t\t\tconfig.control.shouldUpdate = true;\n\t\t}\n\n\t\tRADIUS = Math.min(width / 2, height / 2);\n\t\tcenterX = x + width / 2;\n\t\tcenterY = y + height / 2;\n\n\t\t// const ang = Math.atan2(mouse.newX - centerX, mouse.newY - centerY) * 2\n\t\t// console.log(ang);\n\n\t\tctx.save();\n\t\tctx.beginPath();\n\t\tctx.fillStyle = 'red';\n\t\tctx.moveTo(centerX, centerY);\n\t\tconst angleStart = PI1 * start * 2;\n\t\tconst angleEnd = PI1 * end * 2;\n\t\tctx.arc(centerX, centerY, RADIUS, angleStart, angleEnd);\n\t\tctx.moveTo(centerX, centerY);\n\t\tctx.fillStyle = colors[key];\n\t\tctx.fill();\n\t\tctx.restore();\n\n\t\tctx.save();\n\t\tctx.fillStyle = '#fff';\n\t\tctx.textAlign = 'center';\n\t\tctx.globalAlpha = copacity;\n\t\tctx.textBaseline = 'middle';\n\t\tctx.font = FONT;\n\t\tconst textAngle = angleStart + (angleEnd - angleStart) / 2;\n\t\tconst textX = centerX + Math.cos(textAngle) * (RADIUS / 2);\n\t\tconst textY = centerY + Math.sin(textAngle) * (RADIUS / 2);\n\n\t\t// const startX = centerX + Math.cos(angleStart) * RADIUS;\n\t\t// const startY = centerY + Math.sin(angleStart) * RADIUS;\n\t\t// const endX = centerX + Math.cos(angleEnd) * RADIUS;\n\t\t// const endY = centerY + Math.sin(angleEnd) * RADIUS;\n\t\t// const mouseDistX = Math.abs(centerX - mouse.newX);\n\t\t// const mouseDistY = Math.abs(centerY - mouse.newY);\n\t\t// const mouseDist = Math.sqrt(mouseDistX * mouseDistX + mouseDistY * mouseDistY);\n\t\t// console.log(RADIUS, mouseDist);\n\t\t// ctx.fillRect(startX, startY, 10, 10);\n\t\t// ctx.fillRect(endX, endY, 10, 10);\n\t\t\n\t\t// mouse.newX\n\t\t// mouse.newY\n\t\tctx.fillText(perc.toFixed(0) + '%', textX, textY);\n\t\tctx.restore();\n\t}\n\n\treturn {\n\t\tcalculate: calculate,\n\t\tdraw: drawArea,\n\t}\n}","import {\n\tPIXEL_RATIO,\n\tBOTTOM_PADDING,\n\tX_AXIS_HEIGHT,\n\tONE,\n\tTWO,\n\tDOT_RADIUS,\n\tDOT_RADIUS_DIV_2,\n\tDOT_RADIUS_MUL_2,\n} from '../../Globals';\n\nimport { average } from '../../utils';\nimport AreaLayerDrawer from '../Layers/Area';\nimport { debugLayer } from '../utils';\n\n\n\nexport default function AreaChartDrawer(drawersArgs) {\n\tconst { config } = drawersArgs;\n\tconst { ctx, data } = config;\n\tconst { colors, yAxis, xAxis } = data;\n\tconst chartPadding = 6 * PIXEL_RATIO;\n\tconst chartPadding2 = chartPadding * 2;\n\n\tconst drawAreaLayers = yAxis.items.map(el => AreaLayerDrawer(drawersArgs));\n\n\tfunction destroy() {\n\t\t\n\t}\n\n\tfunction init() {\n\t\t\n\t}\n\n\tfunction drawChart(x, y, width, height) {\n\t\t// debugLayer(ctx, x, y, width, height);\n\n\t\tconst XS = width * config.control.range[0];\n\t\tconst HEIGHT = height - BOTTOM_PADDING - DOT_RADIUS_MUL_2;\n\t\tconst Y = y + DOT_RADIUS + TWO;\n\n\t\tconst itemsStart = Math.floor(xAxis.length * config.control.range[0]);\n\t\tconst itemsDiff = Math.ceil(xAxis.length * (config.control.range[1] - config.control.range[0]));\n\t\tconst itemsEnd = itemsStart + itemsDiff;\n\t\tconst percentage = yAxis.items.reduce((curr, item) => {\n\t\t\treturn curr + item.items.slice(itemsStart, itemsEnd).reduce(average, 0) * item.opacity.value;\n\t\t}, 0) / 100;\n\t\tlet stacked = 0;\n\n\t\tfor (let i = 0; i < yAxis.items.length; i++) {\n\t\t\tconst perc = yAxis.items[i].items.slice(itemsStart, itemsEnd).reduce(average, 0) / percentage * yAxis.items[i].opacity.value;\n\t\t\t// drawAreaLayers[i].calculate(yAxis.items[i], perc, stacked, stacked += perc, x, Y, width, HEIGHT - X_AXIS_HEIGHT);\n\t\t\tdrawAreaLayers[i].draw(yAxis.items[i], perc, stacked, stacked += perc, x, Y, width, HEIGHT - X_AXIS_HEIGHT);\n\t\t}\n\t}\n\n\tdrawChart.destroy = destroy;\n\tdrawChart.init = init;\n\n\treturn drawChart;\n}","import { PIXEL_RATIO } from '../../Globals';\n\n\nexport default function AreaLine({ config, normYKey }, opts = {}) {\n\tconst { ctx, control, data } = config;\n\tconst { colors, yAxis, xAxis } = data;\n\tconst chunkScale = config.scaleX;\n\n\tfunction calculate(data, stacked, percentage, x, y, width, height) {\n\t\t\n\t}\n\n\tfunction drawAreaLine(data, stacked, percentage, x, y, width, height) {\n\t\tconst { key, items, opacity } = data;\n\t\tconst normY = data.scaling[normYKey];\n\t\tconst normYM = normY(1);\n\t\tconst copacity = opacity.value;\n\n\t\tif (!copacity) return;\n\t\tif (copacity < 1) {\n\t\t\tconfig.control.shouldUpdate = true;\n\t\t}\n\t\tconst count = items.length;\n\n\t\tctx.save();\n\t\tctx.beginPath();\n\t\tconst chunkSize = chunkScale * width;\n\t\tconst XS = new Array(count).fill(0);\n\n\t\tconst onePercent = percentage[0];\n\t\tconst perc = Math.round(stacked[0] / onePercent);\n\t\tconst Y = y + height - normYM * perc * height;\n\t\tctx.moveTo(x, Y);\n\t\tXS[0] = x + chunkSize * 0;\n\n\t\tfor (let i = 1; i < count; i++) {\n\t\t\tconst perc = Math.round(stacked[i] / percentage[i]);\n\t\t\tXS[i] = x + chunkSize * i;\n\t\t\tconst Y = y + height - normYM * perc * height;\n\t\t\tctx.lineTo(XS[i], Y);\n\t\t}\n\n\t\tfor (let i = count - 1; i >= 0; i--) {\n\t\t\tstacked[i] += items[i] * copacity;\n\t\t\tconst perc = Math.round(stacked[i] / percentage[i]);\n\t\t\tconst Y = y + height - normYM * perc * height;\n\t\t\tctx.lineTo(XS[i], Y);\n\t\t}\n\t\tctx.closePath();\n\n\t\tctx.fillStyle = colors[key];\n\t\tctx.fill();\n\t\tctx.restore();\n\t}\n\n\treturn {\n\t\tcalculate: calculate,\n\t\tdraw: drawAreaLine,\n\t}\n}","import { throttle } from '../../utils';\nimport { CURRENT, DOT_RADIUS } from '../../Globals';\n\nimport { createMouseDotHandling } from './utils';\n\n\nexport default function AreaLineActivePopup({ config, normYKey }) {\n\tconst { ctx, control, data } = config;\n\tconst { colors, yAxis, xAxis } = data;\n\tconst h = createMouseDotHandling(\n\t\tconfig,\n\t\t{\n\t\t\tpaddingLeftSelector: (context) => DOT_RADIUS,\n\t\t\tpaddingRightSelector: (context) => DOT_RADIUS,\n\t\t\trounding: Math.round,\n\t\t\tplus: 1,\n\t\t}\n\t);\n\n\tfunction destroy() {\n\t\th.destroy();\n\t}\n\n\tfunction init() {\n\t\th.init();\n\t}\n\n\tfunction drawAreaLineActivePopup(data, x, y, width, height) {\n\t\th.current.width = width;\n\t\th.current.height = height;\n\t\th.current.x = x;\n\t\th.current.y = y;\n\n\t\th.count = data.length;\n\t\th.chunkSize = h.chunkScale * width;\n\n\t\tif (h.current.index > -1 && h.current.index < h.count) {\n\t\t\tconst X = x + h.chunkSize * h.current.index;\n\t\t\tctx.save();\n\t\t\tctx.strokeStyle = CURRENT.THEME.gridLines;\n\t\t\tctx.lineWidth = 1;\n\t\t\tctx.globalAlpha = 0.2;\n\t\t\tctx.beginPath();\n\t\t\tctx.moveTo(X, y);\n\t\t\tctx.lineTo(X, y + height);\n\t\t\tctx.stroke();\n\t\t\tctx.restore();\n\t\t}\n\t}\n\n\tdrawAreaLineActivePopup.destroy = destroy;\n\tdrawAreaLineActivePopup.init = init;\n\n\treturn drawAreaLineActivePopup;\n}","import {\n\tPIXEL_RATIO,\n\tBOTTOM_PADDING,\n\tX_AXIS_HEIGHT,\n\tONE,\n\tTWO,\n\tDOT_RADIUS,\n\tDOT_RADIUS_DIV_2,\n\tDOT_RADIUS_MUL_2,\n} from '../../Globals';\n\nimport AreaLineLayerDrawer from '../Layers/AreaLine';\nimport AreaLineActiveLayerDrawer from '../Layers/AreaLineActivePopup';\nimport YAxisLayerDrawer from '../Layers/YAxis';\nimport XAxisLayerDrawer from '../Layers/XAxis';\n\nimport { debugLayer } from '../utils';\n\n\nexport default function AreaChartDrawer(drawersArgs) {\n\tconst { config } = drawersArgs;\n\tconst { ctx, data } = config;\n\tconst { colors, yAxis, xAxis } = data;\n\tconst chartPadding = 6 * PIXEL_RATIO;\n\tconst chartPadding2 = chartPadding * 2;\n\n\tconst drawXAxisLayer = XAxisLayerDrawer(drawersArgs);\n\tconst drawAreaLineLayers = yAxis.items.map(el => AreaLineLayerDrawer(drawersArgs));\n\tconst drawAreaLineActiveLayer = AreaLineActiveLayerDrawer(drawersArgs);\n\tconst drawYAxisLayer = YAxisLayerDrawer(drawersArgs, {\n\t\ttextAlign: 'left',\n\t});\n\n\tfunction destroy() {\n\t\tdrawAreaLineActiveLayer.destroy();\n\t}\n\n\tfunction init() {\n\t\tdrawAreaLineActiveLayer.init();\n\t}\n\n\tfunction drawChart(x, y, width, height) {\n\t\t// debugLayer(ctx, x, y, width, height);\n\n\t\tconst XS = width * config.control.range[0];\n\t\tconst xRanged = x - XS / config.control.scale;\n\t\tconst widthRanged = width / config.control.scale;\n\n\t\tconst HEIGHT = height - BOTTOM_PADDING - DOT_RADIUS_MUL_2;\n\t\tconst Y = y + DOT_RADIUS + TWO;\n\n\t\t// Draw layers\n\t\tconst percentage = new Array(xAxis.length).fill(0);\n\t\tfor (let i = 0; i < yAxis.items.length; i++) {\n\t\t\tfor (let j = 0; j < yAxis.items[i].items.length; j++) {\n\t\t\t\tpercentage[j] += yAxis.items[i].items[j] * yAxis.items[i].opacity.value;\n\t\t\t}\n\t\t}\n\t\tfor (let i = 0; i < xAxis.length; i++) {\n\t\t\tpercentage[i] /= 100;\n\t\t}\n\n\t\tconst stacked = new Array(xAxis.length).fill(0);\n\t\tfor (let i = 0; i < yAxis.items.length; i++) {\n\t\t\t// drawAreaLineLayers[i].calculate(yAxis.items[i], stacked, percentage, xRanged, Y, widthRanged, HEIGHT - X_AXIS_HEIGHT);\n\t\t\tdrawAreaLineLayers[i].draw(yAxis.items[i], stacked, percentage, xRanged, Y, widthRanged, HEIGHT - X_AXIS_HEIGHT);\n\t\t}\n\t\t\n\t\t// console.log(xAxis)\n\t\tdrawAreaLineActiveLayer(xAxis, xRanged, Y, widthRanged, HEIGHT - X_AXIS_HEIGHT);\n\t\t\n\t\tdrawXAxisLayer(xAxis, xRanged, y + HEIGHT - X_AXIS_HEIGHT, widthRanged, X_AXIS_HEIGHT);\n\t\tdrawYAxisLayer(yAxis.items[0], x, Y, width, HEIGHT - X_AXIS_HEIGHT, true);\n\t}\n\n\tdrawChart.destroy = destroy;\n\tdrawChart.init = init;\n\n\treturn drawChart;\n}","import { PIXEL_RATIO, ONE, CURRENT } from '../../Globals';\nimport AreaLineLayerDrawer from '../Layers/AreaLine';\nimport { debugLayer } from '../utils';\nimport { createControlLayer, controlWidthMul2, controlWidth } from './utils';\n\n\nexport default function AreaLineControlsDrawer(drawersArgs) {\n\tconst { config } = drawersArgs;\n\tconst { ctx, data } = config;\n\tconst { colors, yAxis, xAxis } = data;\n\tconst drawAreaLineLayers = yAxis.items.map(el => AreaLineLayerDrawer(drawersArgs));\n\tconst { updateControlBounds, renderControl, destroy: destroyControl, init: initControl } = createControlLayer(config);\n\t\n\tfunction destroy() {\n\t\tdestroyControl();\n\t}\n\n\tfunction init() {\n\t\tinitControl();\n\t}\n\n\tfunction drawControl(x, y, width, height) {\n\t\t// debugLayer(ctx, x, y, width, height);\n\t\t\n\t\tupdateControlBounds(x, width);\n\t\twidth = width - controlWidthMul2;\n\t\tx = x + controlWidth;\n\n\t\tconst percentage = new Array(xAxis.length).fill(0);\n\t\tfor (let i = 0; i < yAxis.items.length; i++) {\n\t\t\tfor (let j = 0; j < yAxis.items[i].items.length; j++) {\n\t\t\t\tpercentage[j] += yAxis.items[i].items[j] * yAxis.items[i].opacity.value;\n\t\t\t}\n\t\t}\n\t\tfor (let i = 0; i < xAxis.length; i++) {\n\t\t\tpercentage[i] /= 100;\n\t\t}\n\n\t\tconst stacked = new Array(xAxis.length).fill(0);\n\t\tfor (let i = 0; i < yAxis.items.length; i++) {\n\t\t\t// drawAreaLineLayers.calculate(yAxis.items[i], stacked, percentage, x, y + 3, width, height - 6);\n\t\t\tdrawAreaLineLayers[i].draw(yAxis.items[i], stacked, percentage, x, y + 3, width, height - 6);\n\t\t}\n\n\t\trenderControl(ctx, x, y, width, height);\n\t}\n\n\tdrawControl.destroy = destroy;\n\tdrawControl.init = init;\n\n\treturn drawControl;\n}","import BarChartDrawer from './Drawers/Charts/BarChart';\nimport BarControlsDrawer from './Drawers/Controls/BarControls';\n\nimport DualLineChartDrawer from './Drawers/Charts/DualLineChart';\nimport LineChartDrawer from './Drawers/Charts/LineChart';\nimport LineControlsDrawer from './Drawers/Controls/LineControls';\n\nimport AreaChartDrawer from './Drawers/Charts/AreaChart';\nimport AreaLineChartDrawer from './Drawers/Charts/AreaLineChart';\nimport AreaLineControlsDrawer from './Drawers/Controls/AreaLineControls';\n\n\nconst DualLine = {\n\tdrawChartFabric: (args) => DualLineChartDrawer(args),\n\tdrawControlFabric: (args) => LineControlsDrawer(args),\n};\n\nconst Bar = {\n\tdrawChartFabric: (args) => BarChartDrawer(args),\n\tdrawControlFabric: (args) => BarControlsDrawer(args),\n};\n\nconst Area = {\t\n\tdrawChartFabric: (args) => AreaLineChartDrawer(args),\n\tdrawControlFabric: (args) => AreaLineControlsDrawer(args),\n};\n\nconst AreaCircle = {\t\n\tdrawChartFabric: (args) => AreaChartDrawer(args),\n\tdrawControlFabric: (args) => AreaLineControlsDrawer(args),\n};\n\nconst Line = {\n\tdrawChartFabric: (args) => LineChartDrawer(args),\n\tdrawControlFabric: (args) => LineControlsDrawer(args),\n};\n\n\nconst ChartTypes = {\n\tbar: Bar,\n\tarea: Area,\n\tline: Line,\n\tdual_line: DualLine,\n};\n\nexport function fabricByDatasource(datasource, isZoom) {\n\tconst types = Object.keys(datasource.types).map(key => datasource.types[key]).filter(el => el !== 'x');\n\tif (!types.length) {\n\t\t// throw new Error(\"DataSet error. No columns for chart\")\n\t\tconsole.warn(\"DataSet error. No columns for chart\")\n\t} else if (types.length > 50) {\n\t\t// throw new Error(\"DataSet error. Supported up to 50 columns on one graph.\")\n\t\tconsole.warn(\"DataSet warning. Supported up to 50 columns on one graph.\")\n\t}\n\n\tconst type = types[0];\n\tif (ChartTypes[type]) {\n\t\tif (datasource.y_scaled) {\n\t\t\tif (type === 'line' || types.length === 2) {\n\t\t\t\treturn ChartTypes['dual_line'];\n\t\t\t} else {\n\t\t\t\t// throw new Error(\"DataSet error. 'y_scaled' is only used with exactly 2 'line' columns.\")\n\t\t\t\tconsole.warn(\"DataSet warning. 'y_scaled' is only used with exactly 2 'line' columns.\");\n\t\t\t}\n\t\t}\n\t\tif (isZoom) {\n\t\t\tif (type === 'area') {\n\t\t\t\treturn AreaCircle;\n\t\t\t}\n\t\t}\n\t\treturn ChartTypes[type]\n\t}\n\n\treturn fabric;\n}\n\nexport default ChartTypes;","// import Mouse from './Utils/Mouse';\nimport { createMouseForChart } from './Utils/Mouse';\nimport { createAnimator, animateObject } from './Utils/Animated';\nimport { prepareDataset, dateString } from './Utils/YAxis';\n\nimport { createElement } from './UI/utils';\nimport { createPopup } from './UI/Popup';\nimport { createHeader } from './UI/Header';\nimport { createButtons } from './UI/Buttons';\n\nimport { fabricByDatasource } from './ChartTypes';\n\n\nimport {\n\tCONTROL_HEIGHT,\n\tCANVAS_HEIGHT,\n\tSIDES_PADDING,\n\tSIDES_PADDING2,\n\tPIXEL_RATIO,\n} from './Globals';\n\nimport {\n\tnormalizeMemo,\n\tnormalize,\n\tthrottleLForceable,\n} from './utils';\n\n\nfunction createControl(config, drawControlFabric, drawersArgs, onRangeUpdate, opts = {}) {\n\tconst drawControl = drawControlFabric(drawersArgs);\n\tconst control = {\n\t\trange: opts.range || [0.7, 1.0],\n\t\tcount: 0,\n\t\tscale: 0,\n\t\tshouldUpdate: true,\n\n\t\tanimateRange(oldRange, newRange) {\n\t\t\tanimateObject(config.animator, control.range, 0, oldRange[0], newRange[0], (val) => control.updateRange(control.range[0], control.range[1]));\n\t\t\tanimateObject(config.animator, control.range, 1, oldRange[1], newRange[1], (val) => control.updateRange(control.range[0], control.range[1]));\n\t\t},\n\n\t\tdestroy: function destroy() {\n\t\t\tdrawControl.destroy();\n\t\t},\n\n\t\tinit: function init() {\n\t\t\tdrawControl.init();\n\t\t},\n\n\t\tupdateRange: function updateRange(start, end) {\n\t\t\tconst scale = end - start;\n\t\t\tconst count = config.data.xAxis.length * scale;\n\t\t\tif (count > 5) {\n\t\t\t\t// control.count = Math.ceil(count);\n\t\t\t\tcontrol.count = (count >> 0) + 1;\n\t\t\t\tcontrol.scale = scale;\n\t\t\t\tcontrol.range[0] = start;\n\t\t\t\tcontrol.range[1] = end;\n\t\t\t\tonRangeUpdate && onRangeUpdate();\n\t\t\t}\n\t\t},\n\n\t\trender: function render() {\n\t\t\t// console.log('update control', index);\n\t\t\tcontrol.shouldUpdate = false;\n\t\t\tconfig.ctx.clearRect(0, CANVAS_HEIGHT - CONTROL_HEIGHT, config.canvasBounds.width, CONTROL_HEIGHT);\n\t\t\tdrawControl(SIDES_PADDING, CANVAS_HEIGHT - CONTROL_HEIGHT, config.canvasBounds.width - SIDES_PADDING2, CONTROL_HEIGHT);\n\t\t}\n\t};\n\n\t// if (opts.fromRange && opts.range) {\n\t// \tanimateObject(config.animator, control.range, 0, opts.fromRange[0], opts.range[0]);\n\t// \tanimateObject(config.animator, control.range, 1, opts.fromRange[1], opts.range[1]);\n\t// }\n\n\treturn control;\n}\n\nfunction createChart(config, drawChartFabric, drawersArgs) {\n\tconst drawChart = drawChartFabric(drawersArgs);\n\tconst chart = {\n\t\tshouldUpdate: false,\n\n\t\tdestroy: function destroy() {\n\t\t\tdrawChart.destroy();\n\t\t},\n\n\t\tinit: function init() {\n\t\t\tdrawChart.init();\n\t\t},\n\n\t\trender: function render() {\n\t\t\t// console.log('update chart', index);\n\t\t\tchart.shouldUpdate = false;\n\t\t\tconfig.ctx.clearRect(0, 0, config.canvasBounds.width, CANVAS_HEIGHT - CONTROL_HEIGHT);\n\t\t\tdrawChart(SIDES_PADDING, 0, config.canvasBounds.width - SIDES_PADDING2, CANVAS_HEIGHT - CONTROL_HEIGHT);\n\t\t}\n\t};\n\n\treturn chart;\n}\n\n\nfunction Chart(OPTS, data, FABRIC) {\n\tconst {\n\t\tcontainer,\n\t\tindex,\n\t} = OPTS;\n\n\t// Init canvas\n\tlet w, h, normControl;\n\tconst title = data.title || OPTS.title || `Chart #${index + 1}`\n\tconst canvasContainer = createElement(container, 'div', 'chart');\n\tconst header = createHeader(canvasContainer, title, '');\n\tconst canvas = createElement(canvasContainer, 'canvas', 'chart__canvas');\n\n\tconst ctx = canvas.getContext('2d');\n\tconst animator = createAnimator();\n\n\tconst config = {\n\t\tcanvas: canvas,\n\t\tctx: ctx,\n\t\tzoomed: false,\n\t\tindex: index,\n\t\tanimator: animator,\n\t\tcanvasBounds: { left: 0, top: 0 },\n\t\tmouse: null,\n\t\tnormalizeForControl: function normalizeForControl(xPos) {\n\t\t\treturn normControl(xPos);\n\t\t},\n\n\t\tpopup: {},\n\t\tbuttons: null,\n\t\tchart: null,\n\t\tcontrol: null,\n\t\tscaleX: 0,\n\t};\n\n\tconfig.mouse = createMouseForChart(config);\n\tconfig.data = prepareDataset(data, config);\n\tconfig.scaleX = normalize(0, config.data.xAxis.length - 1)(1);\n\tconfig.popup = createPopup(canvasContainer, config);\n\tconst footer = createElement(canvasContainer, 'div', 'chart__footer');\n\n\t// if (config.data.yAxis.items.length > 1) {\n\t\tconfig.buttons = createButtons(footer, config, () => {\n\t\t\tupdateNorms(true);\n\t\t});\n\t// }\n\n\tconst updateNorms = throttleLForceable(\n\t\tfunction updateNorms() {\n\t\t\tconst rStart = config.control.range[0];\n\t\t\tconst rEnd = config.control.range[1];\n\t\t\t\n\t\t\tconst startIndexRaw = rStart * config.data.xAxis.length;\n\t\t\tconst startIndex = startIndexRaw < 0 ? 0 : Math.floor(startIndexRaw);\n\t\t\tconst endIndexRaw = rEnd * config.data.xAxis.length;\n\t\t\tconst endIndex = endIndexRaw > config.data.xAxis.length ? config.data.xAxis.length : Math.ceil(endIndexRaw);\n\t\t\tconfig.data.yAxis.items.forEach(y => y.scaling.updateMinMax(startIndex, endIndex));\n\t\t\theader.setSubtitle(`${config.data.xAxis[startIndex].dateStringTitle} - ${config.data.xAxis[endIndex - 1].dateStringTitle}`)\n\t\t}\n\t, 100);\n\n\tfunction updateBounds() {\n\t\t// console.log('BOUNDS')\n\t\tconst newBounds = canvas.getBoundingClientRect();\n\t\tconst newWidth = newBounds.width * PIXEL_RATIO;\n\t\tconst newHeight = newBounds.height * PIXEL_RATIO;\n\n\t\tconfig.canvasBounds.width = newWidth;\n\t\tconfig.canvasBounds.height = CANVAS_HEIGHT;\n\t\tconfig.canvasBounds.left = newBounds.left;\n\t\tconfig.canvasBounds.right = newBounds.right;\n\t\tconfig.canvasBounds.top = newBounds.top;\n\t\tconfig.canvasBounds.bottom = newBounds.bottom;\n\t\tconfig.canvasBounds.x = newBounds.x;\n\t\tconfig.canvasBounds.y = newBounds.y;\n\n\t\tif (config.canvasBounds.width !== newWidth || config.canvasBounds.height !== newHeight) {\n\t\t\tconfig.chart.shouldUpdate = true;\n\t\t\tconfig.control.shouldUpdate = true;\n\t\t\tnormControl = normalizeMemo(SIDES_PADDING2, config.canvasBounds.width - SIDES_PADDING2);\n\t\t\tcanvas.width = config.canvasBounds.width;\n\t\t\tcanvas.height = CANVAS_HEIGHT;\n\t\t}\n\t}\n\n\tfunction render() {\n\t\tupdateBounds();\n\t\tconst isActiveAnimations = config.animator.updateAnimations();\n\t\tif (isActiveAnimations) config.chart.shouldUpdate = true\n\n\t\tconfig.chart.shouldUpdate && config.chart.render();\n\t\tconfig.control.shouldUpdate && config.control.render();\n\t}\n\n\tconst bak = {};\n\n\tfunction zoomOut() {\n\t\tif (config.zoomed) {\n\t\t\tconfig.popup.hide();\n\t\t\tbak.buttons.mergeState(config.buttons);\n\t\t\tconfig.buttons.destroy();\n\t\t\tconfig.chart.destroy();\n\t\t\tconfig.control.destroy();\n\t\t\tdelete config.chart;\n\t\t\tconst range = [config.control.range[0], config.control.range[1]];\n\t\t\tdelete config.control;\n\n\t\t\tconfig.data = bak.data;\n\t\t\tconfig.scaleX = normalize(0, config.data.xAxis.length - 1)(1);\n\t\t\tconfig.buttons = bak.buttons;\n\t\t\tconfig.chart = bak.chart;\n\t\t\tconfig.control = bak.control;\n\t\t\tconfig.control.animateRange(range, config.control.range);\n\n\n\t\t\tconfig.buttons.init();\n\t\t\tconfig.chart.init();\n\t\t\tconfig.control.init();\n\t\t\tconfig.chart.shouldUpdate = true;\n\t\t\tconfig.control.shouldUpdate = true;\n\t\t\tconfig.zoomed = false;\n\t\t\theader.unfreezeSubtitle();\n\t\t\theader.setTitle(title);\n\t\t\tinit();\n\t\t\treturn;\n\t\t}\n\t}\n\n\tfunction zoomIn(timestamp) {\n\t\tif (!config.data.x_on_zoom) return;\n\t\tconst dataRequested = config.data.x_on_zoom(timestamp);\n\t\tif (!dataRequested) {\n\t\t\tconsole.warn(\"'x_on_zoom' should return promise with data\");\n\t\t} else if (!dataRequested.then) {\n\t\t\tconsole.warn(\"'x_on_zoom' should return promise with data\");\n\t\t} else if (dataRequested.then) {\n\t\t\tdataRequested.then(data => {\n\t\t\t\tconst fabric = fabricByDatasource(data, true);\n\n\t\t\t\tconfig.popup.hide();\n\t\t\t\tconfig.buttons.destroy();\n\t\t\t\tconfig.chart.destroy();\n\t\t\t\tconfig.control.destroy();\n\n\t\t\t\tbak.buttons = config.buttons;\n\t\t\t\tbak.chart = config.chart;\n\t\t\t\tbak.control = config.control;\n\t\t\t\tbak.popup = config.popup;\n\t\t\t\tbak.data = config.data;\n\n\t\t\t\tconfig.data = prepareDataset(data, config);\n\t\t\t\tconfig.scaleX = normalize(0, config.data.xAxis.length - 1)(1);\n\t\t\t\tconfig.buttons = createButtons(footer, config, () => updateNorms(true));\n\t\t\t\tconfig.buttons.mergeState(bak.buttons);\n\t\t\t\tconfig.chart = createChart(config, fabric.drawChartFabric, { ...drawersArgs, config });\n\t\t\t\tconfig.control = createControl(config, fabric.drawControlFabric, { ...drawersArgsControl, config }, () => updateNorms(), {\n\t\t\t\t\trange: [config.control.range[0], config.control.range[1]],\n\t\t\t\t});\n\t\t\t\tconfig.control.animateRange(bak.control.range, [0.4, 0.6]);\n\t\t\t\theader.setSubtitle(dateString(timestamp).dateString);\n\t\t\t\theader.freezeSubtitle();\n\t\t\t\tinit();\n\n\t\t\t\tconfig.chart.shouldUpdate = true;\n\t\t\t\tconfig.control.shouldUpdate = true;\n\t\t\t\tconfig.zoomed = true;\n\t\t\t\theader.setTitleButton('Zoom Out', () => {\n\t\t\t\t\tzoomOut();\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tconfig.popup.onClick(zoomIn);\n\n\tconst drawersArgs = { config, normYKey: 'normY' };\n\tconst drawersArgsControl = { config, normYKey: 'normControlY' };\n\n\tconfig.chart = createChart(config, FABRIC.drawChartFabric, drawersArgs);\n\tconfig.control = createControl(config, FABRIC.drawControlFabric, drawersArgsControl, () => updateNorms())\n\n\twindow.addEventListener('resize', updateBounds);\n\n\tfunction init() {\n\t\tconfig.control.updateRange(config.control.range[0], config.control.range[1]);\n\t\tupdateBounds();\n\t\tupdateNorms(true);\n\t}\n\n\tinit();\n\trender();\n\n\treturn {\n\t\trender: render,\n\t\tcontrol: config.control,\n\t\tchart: config.chart,\n\t\tupdate() {\n\t\t\tconfig.chart.shouldUpdate = true;\n\t\t\tconfig.control.shouldUpdate = true;\n\t\t}\n\t};\n}\n\n\nexport default Chart;","import {\n\tCURRENT,\n} from '../Globals';\n\nexport const THEME_DAY = {\n\tbackground: '#FFFFFF',\n\tscrollBackground: '#E2EEF9',\n\tscrollSelector: '#C0D1E1',\n\tgridLines: '#182D3B',\n\ttooltipArrow: '#D2D5D7',\n\tzoomText: '#108BE3',\n};\n\nexport const THEME_NIGHT = {\n\tbackground: '#1B232F',\n\tscrollBackground: '#304259',\n\tscrollSelector: '#56626D',\n\tgridLines: '#FFFFFF',\n\ttooltipArrow: '#D2D5D7',\n\tzoomText: '#48AAF0',\n};\n\nexport function createThemeChanger(onClick) {\n\tconst html = document.querySelector('html');\n\tlet isLight = true;\n\n\tfunction handleChange() {\n\t\tCURRENT.THEME = isLight ? THEME_DAY : THEME_NIGHT;\n\t\tonClick && onClick(isLight);\n\t}\n\n\tdocument.addEventListener('darkmode', () => {\n\t\tconst isDarkMatch = html.className.toLowerCase().split(\" \").indexOf(\"dark\") > -1;\n\t\tisLight = !isDarkMatch;\n\t\thandleChange();\n\t});\n\n\t// handleChange();\n\tdocument.dispatchEvent(new Event('darkmode'));\n\n\treturn {}\n}","import \"./styles/index.scss\";\n\nimport AnimationLoop from \"./Utils/AnimationLoop\";\nimport Chart from \"./Chart\";\n\nimport { createThemeChanger } from \"./UI/Theme\";\nimport { fabricByDatasource } from \"./ChartTypes\";\n\nlet graphsInstances = [];\n\ncreateThemeChanger((isLight) => {\n  graphsInstances.forEach((chart) => chart.update());\n});\n\nfunction initGraphModule() {\n  let index = 0;\n\n  return {\n    render: function Graph(container, chartData, opts = {}) {\n      const graphOpts = {\n        container: container || document.body,\n        index: index++,\n        title: opts.title || undefined,\n      };\n      const fabric = fabricByDatasource(chartData);\n      const graph = Chart(graphOpts, chartData, fabric);\n      AnimationLoop.add(() => {\n        graph.render();\n      });\n      graphsInstances.push(graph);\n      return graph;\n    },\n  };\n}\n\nconst Graph = initGraphModule();\n\nexport default Graph;\n"],"names":["createAnimationLoop","animationHandlers","publicInterface","handler","index","loop","loopTime","i","animationLoop","MONTH_NAMES","DAY_NAMES","PIXEL_RATIO","CONTROL_HEIGHT","DOT_RADIUS","DOT_RADIUS_MUL_2","CANVAS_HEIGHT","SIDES_PADDING","SIDES_PADDING2","PI2","PI1","FONT","AXIS_TEXT_WIDTH","BOTTOM_PADDING","X_AXIS_HEIGHT","X_AXIS_HEIGHT_DIV_2","Y_AXIS_TEXT_PADDING","ONE","TWO","ANIMATION_SPEED","CURRENT","createDispatcher","types","handlers","dispatchers","mouse","type","event","createMouseForChart","config","dispatcher","onMouseDown","e","onMouseMove","onMouseUp","onTouchDown","onTouchMove","Animated","value","duration","onAnimation","fromValue","toValue","AnimationLoop","result","progress","ease","animateObject","animator","object","key","valueFrom","valueTo","onFrame","createAnimator","animations","opts","createAnimation","animation","removeAnimation","updateAnimations","count","isActive","formatNumber","n","short","abs","normalizeMemo","min","max","delta","memo","norm","val","normalize","normalizeAnimated","newMin","throttle","func","limit","inThrottle","args","context","throttleLForceable","force","average","curr","item","uninf","singleMin","set","singleMax","singleMinRange","start","end","singleMaxRange","flatMin","arr","flatMax","flatMinRange","flatMaxRange","zipSum","res","j","DATE_TYPE_HOUR","DATE_TYPE_DAY","DATE_TYPE_WEEK","DATE_TYPES","date","dateString","timestamp","dateType","timezoneOffset","createPercentDefaultHandler","data","resolve","reject","prepareDataset","title","columns","colors","names","percentage","stacked","y_scaled","x_on_zoom","xAxisKey","rawXAxis","rawYAxisList","xDiff","xAxis","el","yAxis","prepareYAxis","rawYs","items","y","yKey","yData","startIndex","endIndex","sharedScaling","scaling_Percentage","scaling_Stacked","scaling_Default","minHeightAnim","maxHeightAnim","rawItems","f","minHeight","maxHeight","updateMinMax","filteredRawItems","err","createElement","parent","elementTag","className","element","createLongPress","button","handlePress","handleLongPress","timeout","dropClick","mouseUp","mouseDown","mouseMove","init","destroy","createPopupHeader","widthArrow","createPopupItem","color","createPopup","container","popup","clickHandlers","currentIndex","changeHtml","createHeader","titleText","subtitleText","header","subtitle","isSubtitleFreezed","onClick","buttonClickHandler","createButtonForAxis","globState","state","longPress","onPress","onLongPress","update","shouldCallUpdateHandler","hide","caller","show","createButtons","globalState","hideAllExcept","hideAll","buttonsWrapper","allButtons","buttons","enabled","oldButtons","Bar","normYKey","ctx","control","chunkScale","draws","prevWidth","shouldBulkRecalculate","shouldRecalculate","calculate","x","width","height","opacity","normY","WIDTH","chunkSize","chunk_2","startBreakpoint","endBreakpoint","X","Y","BAR_HEIGHT","drawBar","activeIndex","isHovered","SIDE_LEFT","SIDE_RIGHT","createMouseDotHandling","paddingLeftSelector","paddingRightSelector","rounding","plus","current","TOUCHED","handleOver","popupBounds","currentPos","paddingLeft","paddingRight","leftOverflow","rightOverflow","moveHandler","downHandler","upHandler","BarDots","h","drawBarDots","YAxis","partsCount","textAlign","drawLine","separateAxis","a","part","partNumber","number","steps","XAxis","forBars","currRaw","step","nextStep","realStep","nextRealStep","breakPoint","currItemWidth","alpha","BarChartDrawer","drawersArgs","drawBarLayer","BarLayerDrawer","calculateActiveBarIndex","BarActivePopup","drawXAxisLayer","XAxisLayerDrawer","__spreadProps","__spreadValues","drawYAxisLayer","YAxisLayerDrawer","drawChart","XS","xRanged","widthRanged","HEIGHT","currentActiveIndex","NONE","DRAG_START","DRAG_END","DRAG_ALL","pipaH","pipaH2","controlWidth","controlWidthMul2","controlWidthDiv2","controlWidthDiv13","controlPipaWidth","controlPipaPos","createControlLayer","OPTS","controlsBounds","mouseMode","oldRange","clickRangeBase","xs","xe","ww","oldWidth","oldX","normOld","diff","newRangeStart","newRangeEnd","clickRangeStart","clickRangeEnd","boundsStart","boundsEnd","updateControlBounds","renderControl","xxxs","ControlsDrawer","barLayers","destroyControl","initControl","drawControl","Line","lineWidth","datas","currOpacity","yh","LineDots","drawLineDots","drawDotsForLines","drawLineLayers","itemsIndex","DualLineChartDrawer","drawLeftYAxisLayer","drawRightYAxisLayer","LineLayerDrawer","calculateLineActivePopupIndex","LineActivePopup","drawYLine","LineChartDrawer","LineActivePopupLayer","lineLayers","Area","RADIUS","centerX","centerY","perc","drawArea","copacity","angleStart","angleEnd","textAngle","textX","textY","AreaChartDrawer","drawAreaLayers","AreaLayerDrawer","itemsStart","itemsDiff","itemsEnd","AreaLine","drawAreaLine","normYM","onePercent","AreaLineActivePopup","drawAreaLineActivePopup","drawAreaLineLayers","AreaLineLayerDrawer","drawAreaLineActiveLayer","AreaLineActiveLayerDrawer","AreaLineControlsDrawer","DualLine","LineControlsDrawer","BarControlsDrawer","AreaLineChartDrawer","AreaCircle","ChartTypes","fabricByDatasource","datasource","isZoom","createControl","drawControlFabric","onRangeUpdate","newRange","scale","createChart","drawChartFabric","chart","Chart","FABRIC","normControl","canvasContainer","canvas","xPos","footer","updateNorms","rStart","rEnd","startIndexRaw","endIndexRaw","updateBounds","newBounds","newWidth","newHeight","render","bak","zoomOut","range","zoomIn","dataRequested","fabric","drawersArgsControl","THEME_DAY","THEME_NIGHT","createThemeChanger","html","isLight","handleChange","graphsInstances","initGraphModule","chartData","graphOpts","graph","Graph"],"mappings":"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"}