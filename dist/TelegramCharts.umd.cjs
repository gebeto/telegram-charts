(function(B,R){typeof exports=="object"&&typeof module!="undefined"?module.exports=R():typeof define=="function"&&define.amd?define(R):(B=typeof globalThis!="undefined"?globalThis:B||self,B.TelegramCharts=R())})(this,function(){"use strict";var We=Object.defineProperty,Ge=Object.defineProperties;var Ke=Object.getOwnPropertyDescriptors;var qt=Object.getOwnPropertySymbols;var Ve=Object.prototype.hasOwnProperty,je=Object.prototype.propertyIsEnumerable;var Jt=(B,R,D)=>R in B?We(B,R,{enumerable:!0,configurable:!0,writable:!0,value:D}):B[R]=D,ct=(B,R)=>{for(var D in R||(R={}))Ve.call(R,D)&&Jt(B,D,R[D]);if(qt)for(var D of qt(R))je.call(R,D)&&Jt(B,D,R[D]);return B},lt=(B,R)=>Ge(B,Ke(R));function B(){const t=[],e={time:0,add(o){t.push(o)},remove(o){const l=t.indexOf(o);l>-1&&t.splice(l,1)}};function n(o){e.time=o;for(let l=0;l<t.length;l++)t[l](o);requestAnimationFrame(n)}return requestAnimationFrame(n),e}const R=B(),D=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Q=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],E=window.devicePixelRatio,G=43*E,$=4*E,j=$*2,K=343*E,ut=16*E,tt=ut*2,Zt=Math.PI*2,Ht=Math.PI/100,dt=`${11*E}px sans-serif`,et=40*E,q=7*E,M=29*E,Qt=M/2,te=5*E,mt=1*E,V=2*E,X=200,O={THEME:{}};function ee(t){const e={},n={},o={x:0,y:0,xRaw:0,yRaw:0,newX:0,newY:0,newXRaw:0,newYRaw:0,isHolding:!1};return t.forEach(l=>{e[l]=[],n[l]=function(a,c){for(let s=0;s<e[l].length;s++)e[l][s](a,c)}}),{mouse:o,addListener(l,a){e[l].push(a)},removeListener(l,a){const c=e[l].indexOf(a);e[l].splice(c,1)},dispatch(l,a){if(n[l])n[l](o,a);else throw Error("Unknown event")}}}function ne(t){const e=ee(["move","enter","leave","down","up"]),n=e.mouse;function o(r){n.xRaw=r.clientX-t.canvasBounds.left,n.yRaw=r.clientY-t.canvasBounds.top,n.x=n.xRaw*E,n.y=n.yRaw*E,n.newXRaw=n.xRaw,n.newYRaw=n.yRaw,n.newX=n.x,n.newY=n.y,e.dispatch("down",r)}function l(r){n.newXRaw=r.clientX-t.canvasBounds.left,n.newYRaw=r.clientY-t.canvasBounds.top,n.newX=n.newXRaw*E,n.newY=n.newYRaw*E,e.dispatch("move",r)}function a(r){n.isHolding=!1,e.dispatch("up",r)}function c(r){o(r.touches[0])}function s(r){l(r.touches[0])}return document.addEventListener("mousedown",o),document.addEventListener("mousemove",l),document.addEventListener("mouseup",a),document.addEventListener("touchstart",c),document.addEventListener("touchmove",s,{passive:!1}),document.addEventListener("touchend",a),document.addEventListener("touchcancel",a),document.addEventListener("selectstart",r=>!1),{mouse:n,addListener:e.addListener,removeListener:e.removeListener}}class oe{constructor(e,n,o){this.onAnimation=o,this.fromValue=e,this.toValue=e,this.value=e,this.startTime=0,this.duration=n,this.delay=0,this.inProgress=!1}playFrom(e,n){this.value=e,this.play(n)}play(e){this.inProgress=!0,this.startTime=R.time,this.toValue=e,this.fromValue=this.value}update(){const e=this._update();return e&&this.onAnimation&&this.onAnimation(this.value),e}_update(){if(this.value===this.toValue)return this.inProgress=!1,!1;this.inProgress=!0;let e=(R.time-this.startTime-this.delay)/this.duration;e<0&&(e=0),e>1&&(e=1);const n=-e*(e-2);return this.value=this.fromValue+(this.toValue-this.fromValue)*n,!0}}function Lt(t,e,n,o,l,a){t.createAnimation(Math.round(o*100),200,r=>{e[n]=r/100,a&&a(e[n])}).play(Math.round(l*100))}function ie(){const t=[],e={active:!1};function n(a,c,s){const r=new oe(a,c,s);return t.push(r),r}function o(a){const c=t.indexOf(a);c>-1&&t.splice(c,1)}function l(){const a=t.length;let c=!1;for(let s=0;s<a;s++)c=t[s].update()||c;return e.active=c,c}return{opts:e,createAnimation:n,removeAnimation:o,updateAnimations:l}}function Ct(t,e){var n=Math.abs(t);return n>1e9&&e?(t/1e9).toFixed(2)+"B":n>1e6&&e?(t/1e6).toFixed(2)+"M":n>1e3&&e?(t/1e3).toFixed(1)+"K":n>1?t.toString().replace(/\B(?=(\d{3})+(?!\d))/g," "):t.toString()}function ae(t,e){const n=e-t,o={};function l(a){return o[a]||(o[a]=(a-t)/n),o[a]}return l.de=function(c){return c*n+t},l.data={delta:n,min:t,max:e},l}function ht(t,e){const n=e-t;function o(l){return(l-t)/n}return o.de=function(a){return a*n+t},o}function W(t,e,n){const o=t.createAnimation(e,X),l=t.createAnimation(n-e,X);function a(c){return(c-o.value)/l.value}return a.updateDelta=(c,s)=>{o.play(c),l.play(s-c)},a}const se=(t,e)=>{let n;return function(){const o=arguments,l=this;n||(t.apply(l,o),n=!0,setTimeout(()=>n=!1,e))}},re=(t,e)=>{let n;return function(o){const l=this;if(o){t.apply(l,null);return}n||(n=!0,setTimeout(()=>{t.apply(l,null),n=!1},e))}},Et=(t,e)=>t+e,F=t=>t===1/0||t===-1/0?0:t,Mt=t=>Math.min.apply(null,t),nt=t=>Math.max.apply(null,t),St=(t,e,n)=>Math.min.apply(null,t.slice(e,1+n)),ot=(t,e,n)=>Math.max.apply(null,t.slice(e,1+n)),pt=t=>Math.min.apply(null,t.map(Mt)),ft=t=>Math.max.apply(null,t.map(nt)),ce=(t,e,n)=>Math.min.apply(null,t.map(o=>St(o,e,n))),le=(t,e,n)=>Math.max.apply(null,t.map(o=>ot(o,e,n))),it=t=>{const e=new Array(t[0].length).fill(0);let n,o;for(n=0;n<t.length;n++)for(o=0;o<t[n].length;o++)e[o]+=t[n][o];return e},ue=36e5,de=864e5,me=3,he={[ue]:{dayString:t=>t.toISOString().split("T")[1].split(":").slice(0,2).join(":"),dateString:t=>`${Q[t.getDay()]}, ${t.toISOString().split("T")[1].split(":").slice(0,2).join(":")}`,dateStringTitle:t=>`${t.getDate()} ${D[t.getMonth()]} ${t.getFullYear()}`},[de]:{dayString:t=>`${D[t.getMonth()]} ${t.getDate()}`,dateString:t=>`${Q[t.getDay()]}, ${t.getDate()} ${D[t.getMonth()]} ${t.getFullYear()}`,dateStringTitle:t=>`${t.getDate()} ${D[t.getMonth()]} ${t.getFullYear()}`},[me]:{dayString:t=>`${D[t.getMonth()]} ${t.getDate()}`,dateString:t=>`${Q[t.getDay()]}, ${t.getDate()} ${D[t.getMonth()]} ${t.getFullYear()}`,dateStringTitle:t=>`${t.getDate()} ${D[t.getMonth()]} ${t.getFullYear()}`}};function kt(t,e,n){const o=new Date(t),l={dayString:`${D[o.getMonth()]} ${o.getDate()}`,dateString:`${Q[o.getDay()]}, ${o.getDate()} ${D[o.getMonth()]} ${o.getFullYear()}`,dateStringTitle:`${o.getDate()} ${D[o.getMonth()]} ${o.getFullYear()}`,date:o,timestamp:t};return e&&(l.dayString=e.dayString(o),l.dateString=e.dateString(o),l.dateStringTitle=e.dateStringTitle(o)),l}function pe(t){return function(n){return new Promise((o,l)=>{o(t)})}}function Dt(t,e){const{title:n,columns:o,types:l,colors:a,names:c}=t,{percentage:s,stacked:r,y_scaled:d,x_on_zoom:m}=t,[[h,...i],...v]=o,w=i[1]-i[0],x=i.map(g=>kt(g,he[w])),p=fe(v,t,e);return{title:n,columns:o,types:l,colors:a,names:c,x_on_zoom:s&&!m?pe(t):m,percentage:s,stacked:r,y_scaled:d,xAxis:x,yAxis:p}}function fe(t,e,n){const o=t.map(l=>{const[a,...c]=l,s={opacity:n.animator.createAnimation(1,X),key:a,scaling:{},enabled:!0,items:c};return e.y_scaled&&(s.scaling.color=e.colors[s.key],s.scaling.minHeight=F(Mt(s.items)),s.scaling.maxHeight=F(nt(s.items)),s.scaling.minHeightAnim=n.animator.createAnimation(0,X),s.scaling.maxHeightAnim=n.animator.createAnimation(0,X),s.scaling.normY=W(n.animator,s.scaling.minHeight,s.scaling.maxHeight),s.scaling.normControlY=W(n.animator,s.scaling.minHeight,s.scaling.maxHeight),s.scaling.updateMinMax=function(d,m){s.scaling.minHeight=F(St(s.items,d,m)),s.scaling.maxHeight=F(ot(s.items,d,m)),s.scaling.minHeightAnim.play(s.scaling.minHeight),s.scaling.maxHeightAnim.play(s.scaling.maxHeight),s.scaling.normY.updateDelta(s.scaling.minHeight,s.scaling.maxHeight)}),s});if(!e.y_scaled){const l={};e.percentage?xe(n,l):e.stacked?ge(n,l,o):ye(n,l,o),o.forEach(a=>{a.scaling=l})}return{items:o}}function xe(t,e,n){const a=t.animator.createAnimation(0,X),c=t.animator.createAnimation(100,X);e.minHeight=0,e.maxHeight=100,e.minHeightAnim=a,e.maxHeightAnim=c,e.normY=W(t.animator,0,100),e.normControlY=W(t.animator,0,100),e.updateMinMax=function(r,d){}}function ge(t,e,n){const o=n.map(h=>h.items),l=0,a=F(nt(it(o))),c=0,s=ot(it(o),l,a),r=t.animator.createAnimation(0,X),d=t.animator.createAnimation(0,X);e.minHeight=c,e.maxHeight=s,e.minHeightAnim=r,e.maxHeightAnim=d,e.normY=W(t.animator,c,s),e.normControlY=W(t.animator,0,a);function m(h,i){const v=n.filter(p=>p.enabled).map(p=>p.items);e.minHeight=0;try{e.maxHeight=F(ot(it(v),h,i))}catch(p){return}e.minHeightAnim.play(e.minHeight),e.maxHeightAnim.play(e.maxHeight),e.normY.updateDelta(e.minHeight,e.maxHeight);const w=0,x=F(nt(it(v)));e.normControlY.updateDelta(w,x)}e.updateMinMax=m}function ye(t,e,n){const o=n.map(h=>h.items),l=F(pt(o)),a=F(ft(o)),c=pt(o),s=ft(o),r=t.animator.createAnimation(0,X),d=t.animator.createAnimation(0,X);e.minHeight=c,e.maxHeight=s,e.minHeightAnim=r,e.maxHeightAnim=d,e.normY=W(t.animator,c,s),e.normControlY=W(t.animator,l,a);function m(h,i){const v=n.filter(p=>p.enabled).map(p=>p.items);e.minHeight=F(ce(v,h,i)),e.maxHeight=F(le(v,h,i)),e.minHeightAnim.play(e.minHeight),e.maxHeightAnim.play(e.maxHeight),e.normY.updateDelta(e.minHeight,e.maxHeight);const w=F(pt(v)),x=F(ft(v));e.normControlY.updateDelta(w,x)}e.updateMinMax=m}function U(t,e,n){const o=document.createElement(e);return o.className=n,t&&t.appendChild(o),o}function Ae(t,e,n){let o=null,l=!1;function a(){if(clearTimeout(o),l){l=!1;return}e&&e()}function c(){o=setTimeout(()=>{n&&n(),l=!0},200)}function s(){clearTimeout(o)}function r(){t.addEventListener("click",a),t.addEventListener("mousedown",c),t.addEventListener("mousemove",s),t.addEventListener("touchstart",c),t.addEventListener("touchmove",s)}function d(){t.removeEventListener("click",a),t.removeEventListener("mousedown",c),t.removeEventListener("mousemove",s),t.removeEventListener("touchstart",c),t.removeEventListener("touchmove",s)}return r(),{init:r,destroy:d}}function ve(t,e){return`
		<strong class="chart__popup-header">
			<span class="chart__popup-header-title">${t}</span>
			${e?'<span class="chart__popup-header-icon"></span>':"<span></span>"}
		</strong>
	`}function we(t,e,n){return`
		<span class="chart__popup-item">
			<span class="chart__popup-item-title">${e}</span>
			<span class="chart__popup-item-value" style="color: ${t}">${Ct(n)}</span>
		</span>
	`}function be(t,e){const n=U(t,"div","chart__popup"),o=[];let l=-1;n.addEventListener("click",()=>{if(e.data.xAxis[l])for(let s=0;s<o.length;s++)o[s](e.data.xAxis[l].timestamp)});function a(s){const d=e.data.yAxis.items.filter(m=>m.enabled).map(m=>we(e.data.colors[m.key],e.data.names[m.key],m.items[s]));d.length&&(n.innerHTML=`
			${ve(e.data.xAxis[s].dateString,e.data.x_on_zoom)}
			${d.join("")}
		`)}return{element:n,update:a,show(s){l=s,a(s),n.style.opacity=1,n.style.visibility="visible"},hide(){l=-1,n.style.opacity=0,n.style.visibility="hidden"},onClick(s){o.push(s)}}}function Te(t,e,n){const o=U(t,"div","chart__header"),l=U(o,"h2","chart__header-title");l.textContent=e;const a=U(o,"h3","chart__header-sub-title");a.textContent=n;let c=!1;return{setTitle(s){l.textContent=s},setTitleButton(s,r){function d(h){r&&r(h),m.removeEventListener("click",d)}const m=U(null,"span","chart__header-title-button");m.textContent=s,m.addEventListener("click",d),l.innerHTML="",l.appendChild(m)},setSubtitle(s){c||(a.textContent=s)},freezeSubtitle(s){c=!0},unfreezeSubtitle(){c=!1}}}function He(t,e,n,o,l){const a=n.key,c={key:a,enabled:!0},s=U(t,"button","chart__buttons-button");s.textContent=e.data.names[a],s.style.backgroundColor=e.data.colors[a],s.style.borderColor=e.data.colors[a];const r=Ae(s,h,i);function d(){t&&t.removeChild(s),r.destroy()}function m(){t&&t.appendChild(s),r.init()}function h(){if(o.activeButtonsCount===1&&c.enabled){s.className="chart__buttons-button error",setTimeout(()=>{s.className="chart__buttons-button"},140);return}c.enabled=!c.enabled,v()}function i(){c.show(),o.hideAllExcept(s)}function v(p){c.enabled===!0?(s.className="chart__buttons-button",s.style.color="#FFF"):(s.className="chart__buttons-button unchecked",s.style.color=e.data.colors[a]);const g=n.enabled!==c.enabled;n.enabled=c.enabled,p&&(n.opacity.value=c.enabled?.99:.01),n.opacity.play(c.enabled?1:0),g&&l&&l(c.enabled)}function w(p){c.enabled&&p!==s&&(c.enabled=!1,v())}function x(){c.enabled||(c.enabled=!0,v())}return c.update=v,c.hide=w,c.show=x,c.destroy=d,c.init=m,c}function _t(t,e,n){const o={activeButtonsCount:e.data.yAxis.items.length,hideAllExcept:r,hideAll:s},l=U(t,"div","chart__buttons"),a={},c=e.data.yAxis.items.map(h=>{const i=He(e.data.yAxis.items.length>1?l:null,e,h,o,v=>{o.activeButtonsCount+=v?1:-1,!(o.activeButtonsCount<1)&&n&&n()});return a[h.key]=i});function s(){c.forEach(h=>{h.hide()})}function r(h){c.forEach(i=>{i.hide(h)})}function d(){c.map(h=>h.destroy()),t.removeChild(l)}function m(){c.map(h=>h.init()),t.appendChild(l)}return a.mergeState=function(i){c.map(v=>{e.control.shouldUpdate=!0,e.chart.shouldUpdate=!0,i[v.key]&&(v.enabled=c.length>1?i[v.key].enabled:!0),v.update(!0)})},a.destroy=d,a.init=m,a}function Rt({config:t,normYKey:e},n={}){const{ctx:o,control:l,data:a}=t,{colors:c,yAxis:s,xAxis:r}=a,d=t.scaleX,m={items:[],width:0,opacity:1,offsetIndex:0};let h=0;function i(p){let g=!1;if(h!==o.canvas.width)return h=o.canvas.width,!0;for(let u=0;u<p.items.length&&!(g=p.items[u].opacity.inProgress||!p.items[u].calculated);u++);return g}function v(p){return!0}function w(p,g,u,T,A,y){const{key:f,items:b,opacity:H}=p,L=p.scaling[e];if(m.opacity=H.value,!m.opacity)return;m.opacity<1&&(t.control.shouldUpdate=!0),m.items=[],m.offsetIndex=0,m.width=d*A;const C=A-m.width;m.width=d*C;const S=b.length,k=d*C,P=k/2,N=-k,Y=o.canvas.width+S;for(let I=0;I<S;I++){g[I]+=b[I]*m.opacity;const z=u+k*I+P,Z=T+y-L(g[I])*y,Ne=L(b[I])*y*m.opacity;if(z<N){m.offsetIndex++;continue}else if(z>Y)break;m.items.push([z,Z,Z+Ne])}p.calculated=!0}function x(p,g,u,T,A,y,f){const{key:b}=p,{items:H,opacity:L}=m;if(!L)return;const C=H.length;o.save(),o.beginPath(),o.lineWidth=m.width,o.strokeStyle=c[b];for(let S=0;S<C;S++){const k=f===S+m.offsetIndex;k&&(o.globalAlpha=.5,o.stroke(),o.globalAlpha=1,o.beginPath()),o.moveTo(H[S][0],H[S][1]),o.lineTo(H[S][0],H[S][2]),k&&(o.stroke(),o.globalAlpha=.5,o.beginPath())}o.stroke(),o.restore()}return{shouldBulkRecalculate:i,shouldRecalculate:v,calculate:w,draw:x}}const Yt=1,It=3;function xt(t,{paddingLeftSelector:e,paddingRightSelector:n,rounding:o,plus:l}){const{ctx:a}=t;t.mouse.mouse;const c=t.popup,s=t.scaleX,r={x:0,y:0,width:0,height:0,indexOld:-1,index:-1},d={count:0,chunkScale:t.scaleX,chunkSize:s*r.width,chunkSizeDiv2:s*r.width/2,onCanvasOld:!1,onCanvas:!1,popupSide:1,current:r};let m=!1;const h=se((x,p)=>{if(d.onCanvasOld=d.onCanvas,d.onCanvas=a.canvas===p.target||a.canvas.nextSibling.contains(p.target),(!d.onCanvas&&d.onCanvasOld||p.target.tagName==="BUTTON")&&(r.index!==-1&&(t.chart.shouldUpdate=!0),r.index=-1,c.hide()),!!d.onCanvas&&p.target===a.canvas&&((d.onCanvas||d.onCanvasOld===!0&&d.onCanvas===!1)&&(r.indexOld=r.index,x.newY>r.y&&x.newY<r.y+r.height?(r.index=d.count-o((r.width+r.x-x.newX)/d.chunkSize+l),r.index<d.count&&r.index>=0?c.show(r.index):(r.index=-1,c.hide())):(r.index=-1,c.hide())),r.indexOld!==r.index)){if(t.chart.shouldUpdate=!0,r.index!==-1){const g=c.element.getBoundingClientRect(),u=(r.index*d.chunkSize+r.x)/E,T=n(d)/E,A=e(d)/E,y=u+g.width+A,f=u-g.width-A;y>t.canvasBounds.width/E?d.popupSide=Yt:f<0&&(d.popupSide=It),d.popupSide===Yt?c.element.style.left=`${u-g.width-T}px`:d.popupSide===It&&(c.element.style.left=`${u+A}px`)}r.indexOld=r.index}},50),i=(x,p)=>{m&&h(x,p)},v=(x,p)=>{m=!0,h(x,p)},w=(x,p)=>{m=!1};return d.destroy=function(){t.mouse.removeListener("move",i),t.mouse.removeListener("down",v),t.mouse.removeListener("up",w),r.indexOld=-1,r.index=-1},d.init=function(){t.mouse.addListener("move",i),t.mouse.addListener("down",v),t.mouse.addListener("up",w)},d.init(),d}function Le({config:t,normYKey:e}){const{ctx:n,control:o,data:l}=t,{colors:a,yAxis:c,xAxis:s}=l,r=xt(t,{paddingLeftSelector:i=>i.chunkSize+(i.chunkSizeDiv2>10?10:i.chunkSizeDiv2),paddingRightSelector:i=>i.chunkSizeDiv2>10?10:i.chunkSizeDiv2,rounding:Math.ceil,plus:0});function d(){r.destroy()}function m(){r.init()}function h(i,v,w,x,p,g){r.current.width=p,r.current.height=g,r.current.x=w,r.current.y=x;const u=p-r.chunkSize;return r.count=i.length,r.chunkSize=r.chunkScale*u,r.chunkSizeDiv2=r.chunkSize/2,r.current.index}return h.destroy=d,h.init=m,h}function J({config:t},e={}){const{ctx:n,control:o,data:l}=t,{colors:a,yAxis:c,xAxis:s}=l,r=6,d=e.textAlign||"left";return function(h,i,v,w,x,p,g){const u=Math.round(h.scaling.minHeightAnim.value),T=Math.round(h.scaling.maxHeightAnim.value),A=h.opacity.value,y=x/r,f=(x+y/2)/r,b=Math.ceil((T-u)/r);n.save(),n.beginPath(),n.fillStyle=h.scaling.color||O.THEME.gridLines,g?n.globalAlpha=A/2:n.globalAlpha=h.scaling.color?.8:.5,n.font=dt,n.textBaseline="bottom",n.textAlign=d;for(let H=0;H<r;H++){p&&(n.moveTo(i,v+x-H*f),n.lineTo(i+w,v+x-H*f));const L=Ct(u+b*H,!0);n.fillText(L,i+3,v+x-H*f-te)}n.lineWidth=1*E,p&&(n.globalAlpha=.1,n.strokeStyle=O.THEME.gridLines,n.stroke()),n.restore()}}const Bt=[0,1,2,4,4,8,8,8,8,16,16,16,16,16,16,16,16,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64,64];function at({config:t,forBars:e}){const{ctx:n,control:o,data:l}=t,{colors:a,yAxis:c,xAxis:s}=l,r=t.scaleX;let d=0;return function(h,i,v,w,x){const p=h.length;e?d=r*(w-r*w):d=r*w,e&&(w=w-d),n.save(),n.fillStyle=O.THEME.gridLines,n.font=dt,n.textAlign="center",n.textBaseline="middle",n.globalAlpha=.5;const g=w*r,u=Math.ceil(et/g),T=u+1,A=Bt[u],y=Bt[T],f=g,b=et/u,L=(f/b-1)*u;for(let C=0;C<p;C+=A){C%y===0||L>.5?n.globalAlpha=.5:n.globalAlpha=L;const k=i+(e?d/2:0)+d*C,P=v+Qt;k<-et||k>n.canvas.width+et||n.fillText(h[C].dayString,k,P)}n.restore()}}function Ce(t){const{config:e}=t,{ctx:n,data:o}=e,{colors:l,yAxis:a,xAxis:c}=o,s=Rt(t),r=Le(t),d=at(lt(ct({},t),{forBars:!0})),m=J(t,{textAlign:"left"});function h(){r.destroy()}function i(){r.init()}function v(w,x,p,g){const u=p*e.control.range[0],T=w-u/e.control.scale,A=p/e.control.scale,y=g-q-j,f=x+V,b=new Array(c.length).fill(0),H=r(c,b,T,f,A,y-M);for(let L=0;L<a.items.length;L++)s.calculate(a.items[L],b,T,f,A,y-M),s.draw(a.items[L],b,T,f,A,y-M,H);d(c,T,x+y-M,A,M),m(a.items[0],w,f,p,y-M,!0)}return v.destroy=h,v.init=i,v}const gt=0,Pt=1,Ft=2,Ee=3,yt=10*E,Xt=yt/2,_=10*E,At=_*2,st=_/2,rt=_-_/3,vt=2*E,zt=(_-vt)/2;function wt(t){const e={controlsBounds:{start:{x:0,y:0,width:0,height:0},end:{x:0,y:0,width:0,height:0}}},n=e.controlsBounds;let o=gt,l=[0,0];const a=14*E;let c=0,s=0,r=s-c,d=0,m=0;function h(u){if(o===gt)return;t.chart.shouldUpdate=!0,t.control.shouldUpdate=!0;const T=t.normalizeForControl(u.newX),A=t.normalizeForControl(u.x),y=T-A,f=l[0]+y,b=l[1]+y;if(o===Pt)f>0?t.control.updateRange(f,l[1]):t.control.updateRange(0,l[1]);else if(o===Ft)b<1?t.control.updateRange(l[0],b):t.control.updateRange(l[0],1);else if(f>=0&&b<=1)t.control.updateRange(f,b);else if(b>1){let H=1-l[1];t.control.updateRange(l[0]+H,l[1]+H)}else if(f<0){let H=0-l[0];t.control.updateRange(l[0]+H,l[1]+H)}}function i(u){const T=a,A=a,y=n.start,f=n.end;u.y>y.y&&u.y<y.y+y.height&&(t.chart.shouldUpdate=!0,t.control.shouldUpdate=!0,l=[t.control.range[0],t.control.range[1]],u.newX>y.x-T&&u.newX<y.x+y.width&&u.newY>y.y-T&&u.newY<y.y+y.height+T?o=Pt:u.newX>f.x&&u.newX<f.x+f.width+A&&u.newY>f.y-A&&u.newY<f.y+f.height+A?o=Ft:u.newX>y.x+y.width&&u.newX<f.x&&u.newY>f.y-a&&u.newY<f.y+f.height+a&&(o=Ee))}function v(u){o=gt}function w(){t.mouse.addListener("move",h),t.mouse.addListener("down",i),t.mouse.addListener("up",v)}function x(){t.mouse.removeListener("move",h),t.mouse.removeListener("down",i),t.mouse.removeListener("up",v)}function p(u,T){d=T,m=u}function g(u,T,A,y,f){c=T+y*t.control.range[0],s=T+y*t.control.range[1],r=s-c,n.start.x=c-_,n.start.y=A,n.start.width=_,n.start.height=f,n.end.x=s,n.end.y=A,n.end.width=_,n.end.height=f,u.save(),u.globalAlpha=.6,u.fillStyle=O.THEME.scrollBackground,u.beginPath(),u.moveTo(c-1,A),u.lineTo(c-1,A+f),u.arcTo(m,A+f,m,A+f-_,st),u.arcTo(m,A,c-1,A,st),u.closePath(),u.fill(),u.beginPath(),u.moveTo(s+1,A),u.lineTo(s+1,A+f),u.arcTo(m+d,A+f,m+d,A+f-_,st),u.arcTo(m+d,A,s,A,st),u.closePath(),u.fill(),u.restore(),u.save(),u.fillStyle=O.THEME.scrollSelector,u.beginPath(),u.rect(c,A,r,mt),u.rect(c,A+f-mt,r,mt),u.fill(),u.beginPath();const b=c;u.moveTo(b,A),u.lineTo(b,A+f),u.arcTo(b-_,A+f,b-_,A+f-_,rt),u.arcTo(b-_,A,b,A,rt),u.closePath(),u.fill(),u.beginPath(),u.moveTo(s,A),u.lineTo(s,A+f),u.arcTo(s+_,A+f,s+_,A+f-_,rt),u.arcTo(s+_,A,s,A,rt),u.closePath(),u.fill(),u.restore(),u.save(),u.beginPath(),u.fillStyle="#FFFFFF",u.rect(c-zt,A+f/2-Xt,-vt,yt),u.rect(s+zt,A+f/2-Xt,vt,yt),u.fill(),u.restore()}return e.updateControlBounds=p,e.renderControl=g,e.destroy=x,e.init=w,w(),e}function Me(t){const{config:e}=t,{ctx:n,data:o}=e,{colors:l,yAxis:a,xAxis:c}=o,s=a.items.map(p=>Rt(t)),{updateControlBounds:r,renderControl:d,destroy:m,init:h}=wt(e);function i(){m()}function v(){h()}const w=new Array(c.length);function x(p,g,u,T){r(p,u),u=u-At,p=p+_,w.fill(0);const A=s[0].shouldBulkRecalculate(a);for(let y=0;y<a.items.length;y++)A&&s[y].calculate(a.items[y],w,p,g+3,u,T-6),s[y].draw(a.items[y],p,g+3,u,T-6);d(n,p,g,u,T)}return x.destroy=i,x.init=v,x}function bt({config:t,normYKey:e},n={}){const{ctx:o,control:l,data:a}=t,{colors:c,yAxis:s,xAxis:r}=a,d=(n.lineWidth||2)*E,m=t.scaleX,h={items:[],opacity:1,offsetIndex:0};let i=0;function v(g){return!0}function w(g){const u=g.opacity.inProgress||!g.calculated||o.canvas.width!==i;return i=o.canvas.width,u}function x(g,u,T,A,y){const{key:f,items:b,opacity:H}=g,L=g.scaling[e],C=H.value;if(h.opacity=H.value,!C)return;C<1&&(t.control.shouldUpdate=!0),h.items=[],h.offsetIndex=0;const S=b.length,k=m*A,P=T+y,N=-k,Y=o.canvas.width+k;h.items.push([u+0,P-L(b[0])*y]);for(let I=1;I<S;I++){const z=u+k*I,Z=P-L(b[I])*y;if(Z>P&&(t.control.shouldUpdate=!0),z<N){h.offsetIndex++;continue}else if(z>Y)break;h.items.push([z,Z])}g.calculated=!0}function p(g,u,T,A,y){const{items:f,opacity:b}=h,{key:H}=g;if(!b)return;const L=f.length;o.save(),o.beginPath(),o.moveTo(f[0][0],f[0][1]);for(let C=1;C<L;C++)o.lineTo(f[C][0],f[C][1]);o.lineWidth=d,o.strokeStyle=c[H],o.globalAlpha=b,o.lineJoin="round",o.stroke(),o.restore()}return{draws:h,shouldBulkRecalculate:v,shouldRecalculate:w,calculate:x,draw:p}}function $t({config:t,normYKey:e}){const{ctx:n,control:o,data:l}=t,{colors:a,yAxis:c,xAxis:s}=l,r=xt(t,{paddingLeftSelector:i=>$,paddingRightSelector:i=>$,rounding:Math.round,plus:1});function d(){r.destroy()}function m(){r.init()}function h(i,v,w,x,p){return r.current.width=x,r.current.height=p,r.current.x=v,r.current.y=w,r.count=i.length,r.chunkSize=r.chunkScale*x,r.current.index}return h.destroy=d,h.init=m,h}function Ut({config:t},e,n,o,l){const{ctx:a,data:c}=t,{colors:s,yAxis:r,xAxis:d}=c;for(let m=0;m<r.items.length;m++){const{key:h}=r.items[m],{draws:i}=l[m],v=o-i.offsetIndex;if(i.items[v]){const[w,x]=i.items[v];a.save(),a.strokeStyle=O.THEME.gridLines,a.lineWidth=1,a.globalAlpha=.1,a.beginPath(),a.moveTo(w,e),a.lineTo(w,e+n),a.stroke(),a.restore(),a.save(),a.beginPath(),a.arc(w,x,$,0,Zt),a.fillStyle=O.THEME.background,a.lineWidth=V,a.globalAlpha=i.opacity,a.strokeStyle=s[h],a.fill(),a.stroke(),a.restore()}}}function Se(t){const{config:e}=t,{ctx:n,data:o}=e,{colors:l,yAxis:a,xAxis:c}=o,s=J(t,{textAlign:"left"}),r=J(t,{textAlign:"right"}),d=at(t),m=a.items.map(x=>bt(t)),h=$t(t);function i(){h.destroy()}function v(){h.init()}function w(x,p,g,u){const T=g*e.control.range[0],A=x-T/e.control.scale,y=g/e.control.scale,f=u-q-j,b=p+$+V;d(c,A,p+f-M,y,M);let H=!0;a.items[0].enabled&&(s(a.items[0],x,b,g,f-M,H),H=!1),a.items[1].enabled&&(r(a.items[1],x+g,b,-g,f-M,H),H=!1);const L=h(c,A,b,y,f-M);for(let C=0;C<a.items.length;C++)m[C].calculate(a.items[C],A,b,y,f-M),m[C].draw(a.items[C],A,b,y,f-M,L);Ut(t,p,u,L,m)}return w.destroy=i,w.init=v,w}function ke(t){const{config:e}=t,{ctx:n,data:o}=e,{colors:l,yAxis:a,xAxis:c}=o,s=a.items.map(w=>bt(t)),r=$t(t),d=at(t),m=J(t,{textAlign:"left"});function h(){r.destroy()}function i(){r.init()}function v(w,x,p,g){const u=p*e.control.range[0],T=w-u/e.control.scale,A=p/e.control.scale,y=g-q-j,f=x+$+V;d(c,T,x+y-M,A,M),m(a.items[0],w,f,p,y-M,!0);for(let H=0;H<a.items.length;H++)s[H].calculate(a.items[H],T,f,A,y-M),s[H].draw(a.items[H],T,f,A,y-M);const b=r(c,T,f,A,y-M);Ut(t,x,g,b,s)}return v.destroy=h,v.init=i,v}function Ot(t){const{config:e}=t,{ctx:n,data:o}=e,{colors:l,yAxis:a,xAxis:c}=o,s=a.items.map(x=>bt(t,{lineWidth:1})),{updateControlBounds:r,renderControl:d,destroy:m,init:h}=wt(e);function i(){m()}function v(){h()}function w(x,p,g,u){r(x,g),g=g-At,x=x+_;for(let T=0;T<a.items.length;T++)s[T].shouldRecalculate(a.items[T])&&s[T].calculate(a.items[T],x,p+3,g,u-6),s[T].draw(a.items[T],x,p+3,g,u-6);d(n,x,p,g,u)}return w.destroy=i,w.init=v,w}function De({config:t,normYKey:e},n={}){const{ctx:o,control:l,data:a}=t,{colors:c,yAxis:s,xAxis:r}=a;t.mouse.mouse,t.popup,t.scaleX;let d=0,m=0,h=0;function i(w,x,p,g,u,T,A,y){}function v(w,x,p,g,u,T,A,y){const{key:f,items:b,opacity:H}=w,L=H.value;if(!L)return;L<1&&(t.control.shouldUpdate=!0),d=Math.min(A/2,y/2),m=u+A/2,h=T+y/2,o.save(),o.beginPath(),o.fillStyle="red",o.moveTo(m,h);const C=Ht*p*2,S=Ht*g*2;o.arc(m,h,d,C,S),o.moveTo(m,h),o.fillStyle=c[f],o.fill(),o.restore(),o.save(),o.fillStyle="#fff",o.textAlign="center",o.globalAlpha=L,o.textBaseline="middle",o.font=dt;const k=C+(S-C)/2,P=m+Math.cos(k)*(d/2),N=h+Math.sin(k)*(d/2);o.fillText(x.toFixed(0)+"%",P,N),o.restore()}return{calculate:i,draw:v}}function _e(t){const{config:e}=t,{ctx:n,data:o}=e,{colors:l,yAxis:a,xAxis:c}=o,s=a.items.map(h=>De(t));function r(){}function d(){}function m(h,i,v,w){v*e.control.range[0];const x=w-q-j,p=i+$+V,g=Math.floor(c.length*e.control.range[0]),u=Math.ceil(c.length*(e.control.range[1]-e.control.range[0])),T=g+u,A=a.items.reduce((f,b)=>f+b.items.slice(g,T).reduce(Et,0)*b.opacity.value,0)/100;let y=0;for(let f=0;f<a.items.length;f++){const b=a.items[f].items.slice(g,T).reduce(Et,0)/A*a.items[f].opacity.value;s[f].draw(a.items[f],b,y,y+=b,h,p,v,x-M)}}return m.destroy=r,m.init=d,m}function Nt({config:t,normYKey:e},n={}){const{ctx:o,control:l,data:a}=t,{colors:c,yAxis:s,xAxis:r}=a,d=t.scaleX;function m(i,v,w,x,p,g,u){}function h(i,v,w,x,p,g,u){const{key:T,items:A,opacity:y}=i,f=i.scaling[e],b=f(1),H=y.value;if(!H)return;H<1&&(t.control.shouldUpdate=!0);const L=A.length;o.save(),o.beginPath();const C=d*g,S=new Array(L).fill(0),k=w[0],P=Math.round(v[0]/k),N=p+u-b*P*u;o.moveTo(x,N),S[0]=x+C*0;for(let Y=1;Y<L;Y++){const I=Math.round(v[Y]/w[Y]);S[Y]=x+C*Y;const z=p+u-b*I*u;o.lineTo(S[Y],z)}for(let Y=L-1;Y>=0;Y--){v[Y]+=A[Y]*H;const I=Math.round(v[Y]/w[Y]),z=p+u-b*I*u;o.lineTo(S[Y],z)}o.closePath(),o.fillStyle=c[T],o.fill(),o.restore()}return{calculate:m,draw:h}}function Re({config:t,normYKey:e}){const{ctx:n,control:o,data:l}=t,{colors:a,yAxis:c,xAxis:s}=l,r=xt(t,{paddingLeftSelector:i=>$,paddingRightSelector:i=>$,rounding:Math.round,plus:1});function d(){r.destroy()}function m(){r.init()}function h(i,v,w,x,p){if(r.current.width=x,r.current.height=p,r.current.x=v,r.current.y=w,r.count=i.length,r.chunkSize=r.chunkScale*x,r.current.index>-1&&r.current.index<r.count){const g=v+r.chunkSize*r.current.index;n.save(),n.strokeStyle=O.THEME.gridLines,n.lineWidth=1,n.globalAlpha=.2,n.beginPath(),n.moveTo(g,w),n.lineTo(g,w+p),n.stroke(),n.restore()}}return h.destroy=d,h.init=m,h}function Ye(t){const{config:e}=t,{ctx:n,data:o}=e,{colors:l,yAxis:a,xAxis:c}=o,s=at(t),r=a.items.map(w=>Nt(t)),d=Re(t),m=J(t,{textAlign:"left"});function h(){d.destroy()}function i(){d.init()}function v(w,x,p,g){const u=p*e.control.range[0],T=w-u/e.control.scale,A=p/e.control.scale,y=g-q-j,f=x+$+V,b=new Array(c.length).fill(0);for(let L=0;L<a.items.length;L++)for(let C=0;C<a.items[L].items.length;C++)b[C]+=a.items[L].items[C]*a.items[L].opacity.value;for(let L=0;L<c.length;L++)b[L]/=100;const H=new Array(c.length).fill(0);for(let L=0;L<a.items.length;L++)r[L].draw(a.items[L],H,b,T,f,A,y-M);d(c,T,f,A,y-M),s(c,T,x+y-M,A,M),m(a.items[0],w,f,p,y-M,!0)}return v.destroy=h,v.init=i,v}function Wt(t){const{config:e}=t,{ctx:n,data:o}=e,{colors:l,yAxis:a,xAxis:c}=o,s=a.items.map(x=>Nt(t)),{updateControlBounds:r,renderControl:d,destroy:m,init:h}=wt(e);function i(){m()}function v(){h()}function w(x,p,g,u){r(x,g),g=g-At,x=x+_;const T=new Array(c.length).fill(0);for(let y=0;y<a.items.length;y++)for(let f=0;f<a.items[y].items.length;f++)T[f]+=a.items[y].items[f]*a.items[y].opacity.value;for(let y=0;y<c.length;y++)T[y]/=100;const A=new Array(c.length).fill(0);for(let y=0;y<a.items.length;y++)s[y].draw(a.items[y],A,T,x,p+3,g,u-6);d(n,x,p,g,u)}return w.destroy=i,w.init=v,w}const Ie={drawChartFabric:t=>Se(t),drawControlFabric:t=>Ot(t)},Be={drawChartFabric:t=>Ce(t),drawControlFabric:t=>Me(t)},Pe={drawChartFabric:t=>Ye(t),drawControlFabric:t=>Wt(t)},Fe={drawChartFabric:t=>_e(t),drawControlFabric:t=>Wt(t)},Tt={bar:Be,area:Pe,line:{drawChartFabric:t=>ke(t),drawControlFabric:t=>Ot(t)},dual_line:Ie};function Gt(t,e){const n=Object.keys(t.types).map(l=>t.types[l]).filter(l=>l!=="x");n.length?n.length>50&&console.warn("DataSet warning. Supported up to 50 columns on one graph."):console.warn("DataSet error. No columns for chart");const o=n[0];if(Tt[o]){if(t.y_scaled){if(o==="line"||n.length===2)return Tt.dual_line;console.warn("DataSet warning. 'y_scaled' is only used with exactly 2 'line' columns.")}return e&&o==="area"?Fe:Tt[o]}return fabric}function Kt(t,e,n,o,l={}){const a=e(n),c={range:l.range||[.7,1],count:0,scale:0,shouldUpdate:!0,animateRange(s,r){Lt(t.animator,c.range,0,s[0],r[0],d=>c.updateRange(c.range[0],c.range[1])),Lt(t.animator,c.range,1,s[1],r[1],d=>c.updateRange(c.range[0],c.range[1]))},destroy:function(){a.destroy()},init:function(){a.init()},updateRange:function(r,d){const m=d-r,h=t.data.xAxis.length*m;h>5&&(c.count=(h>>0)+1,c.scale=m,c.range[0]=r,c.range[1]=d,o&&o())},render:function(){c.shouldUpdate=!1,t.ctx.clearRect(0,K-G,t.canvasBounds.width,G),a(ut,K-G,t.canvasBounds.width-tt,G)}};return c}function Vt(t,e,n){const o=e(n),l={shouldUpdate:!1,destroy:function(){o.destroy()},init:function(){o.init()},render:function(){l.shouldUpdate=!1,t.ctx.clearRect(0,0,t.canvasBounds.width,K-G),o(ut,0,t.canvasBounds.width-tt,K-G)}};return l}function Xe(t,e,n){const{container:o,index:l}=t;let a;const c=e.title||t.title||`Chart #${l+1}`,s=U(o,"div","chart"),r=Te(s,c,""),d=U(s,"canvas","chart__canvas"),m=d.getContext("2d"),h=ie(),i={canvas:d,ctx:m,zoomed:!1,index:l,animator:h,canvasBounds:{left:0,top:0},mouse:null,normalizeForControl:function(H){return a(H)},popup:{},buttons:null,chart:null,control:null,scaleX:0};i.mouse=ne(i),i.data=Dt(e,i),i.scaleX=ht(0,i.data.xAxis.length-1)(1),i.popup=be(s,i);const v=U(s,"div","chart__footer");i.buttons=_t(v,i,()=>{w(!0)});const w=re(function(){const H=i.control.range[0],L=i.control.range[1],C=H*i.data.xAxis.length,S=C<0?0:Math.floor(C),k=L*i.data.xAxis.length,P=k>i.data.xAxis.length?i.data.xAxis.length:Math.ceil(k);i.data.yAxis.items.forEach(N=>N.scaling.updateMinMax(S,P)),r.setSubtitle(`${i.data.xAxis[S].dateStringTitle} - ${i.data.xAxis[P-1].dateStringTitle}`)},100);function x(){const b=d.getBoundingClientRect(),H=b.width*E,L=b.height*E;i.canvasBounds.width=H,i.canvasBounds.height=K,i.canvasBounds.left=b.left,i.canvasBounds.right=b.right,i.canvasBounds.top=b.top,i.canvasBounds.bottom=b.bottom,i.canvasBounds.x=b.x,i.canvasBounds.y=b.y,(i.canvasBounds.width!==H||i.canvasBounds.height!==L)&&(i.chart.shouldUpdate=!0,i.control.shouldUpdate=!0,a=ae(tt,i.canvasBounds.width-tt),d.width=i.canvasBounds.width,d.height=K)}function p(){x(),i.animator.updateAnimations()&&(i.chart.shouldUpdate=!0),i.chart.shouldUpdate&&i.chart.render(),i.control.shouldUpdate&&i.control.render()}const g={};function u(){if(i.zoomed){i.popup.hide(),g.buttons.mergeState(i.buttons),i.buttons.destroy(),i.chart.destroy(),i.control.destroy(),delete i.chart;const b=[i.control.range[0],i.control.range[1]];delete i.control,i.data=g.data,i.scaleX=ht(0,i.data.xAxis.length-1)(1),i.buttons=g.buttons,i.chart=g.chart,i.control=g.control,i.control.animateRange(b,i.control.range),i.buttons.init(),i.chart.init(),i.control.init(),i.chart.shouldUpdate=!0,i.control.shouldUpdate=!0,i.zoomed=!1,r.unfreezeSubtitle(),r.setTitle(c),f();return}}function T(b){if(!i.data.x_on_zoom)return;const H=i.data.x_on_zoom(b);H&&H.then?H.then&&H.then(L=>{const C=Gt(L,!0);i.popup.hide(),i.buttons.destroy(),i.chart.destroy(),i.control.destroy(),g.buttons=i.buttons,g.chart=i.chart,g.control=i.control,g.popup=i.popup,g.data=i.data,i.data=Dt(L,i),i.scaleX=ht(0,i.data.xAxis.length-1)(1),i.buttons=_t(v,i,()=>w(!0)),i.buttons.mergeState(g.buttons),i.chart=Vt(i,C.drawChartFabric,lt(ct({},A),{config:i})),i.control=Kt(i,C.drawControlFabric,lt(ct({},y),{config:i}),()=>w(),{range:[i.control.range[0],i.control.range[1]]}),i.control.animateRange(g.control.range,[.4,.6]),r.setSubtitle(kt(b).dateString),r.freezeSubtitle(),f(),i.chart.shouldUpdate=!0,i.control.shouldUpdate=!0,i.zoomed=!0,r.setTitleButton("Zoom Out",()=>{u()})}):console.warn("'x_on_zoom' should return promise with data")}i.popup.onClick(T);const A={config:i,normYKey:"normY"},y={config:i,normYKey:"normControlY"};i.chart=Vt(i,n.drawChartFabric,A),i.control=Kt(i,n.drawControlFabric,y,()=>w()),window.addEventListener("resize",x);function f(){i.control.updateRange(i.control.range[0],i.control.range[1]),x(),w(!0)}return f(),p(),{render:p,control:i.control,chart:i.chart,update(){i.chart.shouldUpdate=!0,i.control.shouldUpdate=!0}}}const ze={background:"#FFFFFF",scrollBackground:"#E2EEF9",scrollSelector:"#C0D1E1",gridLines:"#182D3B",tooltipArrow:"#D2D5D7",zoomText:"#108BE3"},$e={background:"#1B232F",scrollBackground:"#304259",scrollSelector:"#56626D",gridLines:"#FFFFFF",tooltipArrow:"#D2D5D7",zoomText:"#48AAF0"};function Ue(t){const e=document.querySelector("html");let n=!0;function o(){O.THEME=n?ze:$e,t&&t(n)}return document.addEventListener("darkmode",()=>{n=!(e.className.toLowerCase().split(" ").indexOf("dark")>-1),o()}),document.dispatchEvent(new Event("darkmode")),{}}let jt=[];Ue(t=>{jt.forEach(e=>e.update())});function Oe(){let t=0;return{render:function(n,o,l={}){const a={container:n||document.body,index:t++,title:l.title||void 0},c=Gt(o),s=Xe(a,o,c);return R.add(()=>{s.render()}),jt.push(s),s}}}return Oe()});
//# sourceMappingURL=TelegramCharts.umd.cjs.map
